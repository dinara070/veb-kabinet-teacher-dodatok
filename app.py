import streamlit as st
import sqlite3
import pandas as pd
import hashlib
from datetime import datetime
import io
import altair as alt
import re  # –î–ª—è –ª–æ–≥—ñ–∫–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –∫—É—Ä—Å—ñ–≤

# --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø –°–¢–û–†–Ü–ù–ö–ò ---
st.set_page_config(page_title="Veb kabinet", layout="wide", page_icon="üéì")

# --- –õ–û–ì–Ü–ö–ê –ü–ï–†–ï–ú–ò–ö–ê–ù–ù–Ø –¢–ï–ú–ò ---
if 'theme' not in st.session_state:
    st.session_state.theme = 'light'

def toggle_theme():
    if st.session_state.theme == 'light':
        st.session_state.theme = 'dark'
    else:
        st.session_state.theme = 'light'

# --- CSS –°–¢–ò–õ–Ü ---
dark_css = """
<style>
    .stApp { background-color: #0E1117; color: #FFFFFF; }
    [data-testid="stSidebar"] { background-color: #262730; }
    h1, h2, h3, h4, h5, h6, p, li, span, label, .stMarkdown { color: #FFFFFF !important; }
    .stTextInput > div > div, .stSelectbox > div > div, .stTextArea > div > div, .stDateInput > div > div, .stNumberInput > div > div {
        background-color: #41444C !important; color: #FFFFFF !important;
    }
    input, textarea { color: #FFFFFF !important; }
    [data-testid="stDataFrame"], [data-testid="stTable"] { color: #FFFFFF !important; }
    .streamlit-expanderHeader { background-color: #262730 !important; color: #FFFFFF !important; }
    button { color: #FFFFFF !important; }
</style>
"""

light_css = """
<style>
    .stApp { background-color: #FFFFFF; color: #000000; }
    [data-testid="stSidebar"] { background-color: #F0F2F6; }
    h1, h2, h3, h4, h5, h6, p, li, span, label, .stMarkdown { color: #000000 !important; }
    .stTextInput > div > div, .stSelectbox > div > div, .stTextArea > div > div, .stDateInput > div > div, .stNumberInput > div > div {
        background-color: #FFFFFF !important; color: #000000 !important; border: 1px solid #D3D3D3;
    }
    input, textarea { color: #000000 !important; }
    [data-testid="stDataFrame"], [data-testid="stTable"] { color: #000000 !important; }
    .streamlit-expanderHeader { background-color: #F0F2F6 !important; color: #000000 !important; }
    button { color: #000000 !important; }
</style>
"""

if st.session_state.theme == 'dark':
    st.markdown(dark_css, unsafe_allow_html=True)
else:
    st.markdown(light_css, unsafe_allow_html=True)


# --- –ö–û–ù–°–¢–ê–ù–¢–ò –¢–ê –ü–†–ê–í–ê –î–û–°–¢–£–ü–£ ---
ROLES_LIST = ["teacher"]
TEACHER_LEVEL = ['teacher']
DEAN_LEVEL = ['teacher']

# --- –°–ü–ò–°–û–ö –ü–†–ï–î–ú–ï–¢–Ü–í ---
SUBJECTS_LIST = [
    "–§—ñ–ª–æ—Å–æ—Ñ—ñ—è", "–Ü—Å—Ç–æ—Ä—ñ—è —ñ –∫—É–ª—å—Ç—É—Ä–∞ –£–∫—Ä–∞—ó–Ω–∏", "–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞ –º–æ–≤–∞ (–∑–∞ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–º —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è–º)", "–ü–µ–¥–∞–≥–æ–≥—ñ–∫–∞",
    "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞ –¥–ª—è –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è", "–Ü–Ω–æ–∑–µ–º–Ω–∞ –º–æ–≤–∞ –¥–ª—è –∞–∫–∞–¥–µ–º—ñ—á–Ω–æ–≥–æ —Å–ø—ñ–ª–∫—É–≤–∞–Ω–Ω—è (–º–∞–≥—ñ—Å—Ç—Ä–∏)", "–ó–∞–≥–∞–ª—å–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è",
    "–í—ñ–∫–æ–≤–∞ —ñ –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è", "–°–æ—Ü—ñ–∞–ª—å–Ω–∞ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è", "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è (–∑–∞–≥–∞–ª—å–Ω–∞)", "–ü—Å–∏—Ö–æ–ª–æ–≥—ñ—è –ª—ñ–¥–µ—Ä—Å—Ç–≤–∞",
    "–Ü—Å—Ç–æ—Ä—ñ—è –ø–µ–¥–∞–≥–æ–≥—ñ–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –≤–∏—Ö–æ–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏", "–û—Å–Ω–æ–≤–∏ –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–æ—ó –º–∞–π—Å—Ç–µ—Ä–Ω–æ—Å—Ç—ñ", "–ü—Ä–∞–≤–æ–∑–Ω–∞–≤—Å—Ç–≤–æ", 
    "–†–∏—Ç–æ—Ä–∏–∫–∞",  "–õ—ñ—Ç–µ—Ä–∞—Ç—É—Ä–∞ —ñ –∫—ñ–Ω–æ", "–ü—Ä–∞–≤–∞ —Ç–∞ —Å–≤–æ–±–æ–¥–∏ –ª—é–¥–∏–Ω–∏ —ñ –≥—Ä–æ–º–∞–¥—è–Ω–∏–Ω–∞", "–¶–∏–≤—ñ–ª—å–Ω–∏–π –∑–∞—Ö–∏—Å—Ç", "–ë–µ–∑–ø–µ–∫–∞ –∂–∏—Ç—Ç—î–¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ —Ç–∞ –æ—Å–Ω–æ–≤–∏ –æ—Ö–æ—Ä–æ–Ω–∏ –ø—Ä–∞—Ü—ñ",
    "–ë–∞–∑–æ–≤–∞ –∑–∞–≥–∞–ª—å–Ω–æ–≤—ñ–π—Å—å–∫–æ–≤–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞", "–¢—Ä–µ–Ω—ñ–Ω–≥ —Ä–æ–∑–≤–∏—Ç–∫—É —Å—Ç—Ä–µ—Å–æ—Å—Ç—ñ–π–∫–æ—Å—Ç—ñ", "–î–æ–º–µ–¥–∏—á–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞", "–§—ñ–∑–∏—á–Ω–∞ –∫—É–ª—å—Ç—É—Ä–∞",
    "–ü–æ–ª—å—Å—å–∫–∞ –º–æ–≤–∞: –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –∫—É—Ä—Å", "–ï–∫–æ–ª–æ–≥—ñ—è", "–§—ñ–Ω–∞–Ω—Å–æ–≤–∞ –≥—Ä–∞–º–æ—Ç–Ω—ñ—Å—Ç—å", "–ß–∏—Å–ª–æ–≤—ñ —Å–∏—Å—Ç–µ–º–∏", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑", "–õ—ñ–Ω—ñ–π–Ω–∞ –∞–ª–≥–µ–±—Ä–∞", "–õ—ñ–Ω—ñ–π–Ω–∞ –∞–ª–≥–µ–±—Ä–∞ —ñ –∞–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è", "–ê–Ω–∞–ª—ñ—Ç–∏—á–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è",
    "–ê–ª–≥–µ–±—Ä–∞ —ñ —Ç–µ–æ—Ä—ñ—è —á–∏—Å–µ–ª", "–ï–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞", "–ï–ª–µ–º–µ–Ω—Ç–∞—Ä–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞ –∑ —Ç–æ—á–∫–∏ –∑–æ—Ä—É –≤–∏—â–æ—ó",
    "–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è —Ç–∞ —Ä—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏", "–†—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏", 
    "–¢–µ–æ—Ä—ñ—è –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π —Ç–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "–û—Å–Ω–æ–≤–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —ñ –∞–Ω–∞–ª—ñ–∑—É –¥–∞–Ω–∏—Ö", "–ü—Ä–∏–∫–ª–∞–¥–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω—ñ –≤–∏–º—ñ—Ä—é–≤–∞–Ω–Ω—è —Ç–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —è–∫–æ—Å—Ç—ñ –æ—Å–≤—ñ—Ç–∏", 
    "–ô–º–æ–≤—ñ—Ä–Ω—ñ—Å–Ω–æ-—Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∞ –ª–æ–≥—ñ–∫–∞ —ñ —Ç–µ–æ—Ä—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤", "–î–∏—Å–∫—Ä–µ—Ç–Ω–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞",
    "–û—Å–Ω–æ–≤–∏ –∞–ª–≥–µ–±—Ä–∏ —ñ –¥–∏—Å–∫—Ä–µ—Ç–Ω–æ—ó –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–¢–µ–æ—Ä—ñ—è –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤", "–§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑", "–ö–æ–º–ø–ª–µ–∫—Å–Ω–∏–π –∞–Ω–∞–ª—ñ–∑",
    "–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–∞–ª—å–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è —ñ —Ç–æ–ø–æ–ª–æ–≥—ñ—è", "–û—Å–Ω–æ–≤–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó", "–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è", "–î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–æ–∑–¥—ñ–ª–∏ –≥–µ–æ–º–µ—Ç—Ä—ñ—ó",
    "–ö–æ–º–±—ñ–Ω–∞—Ç–æ—Ä–∏–∫–∞ —ñ –æ—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó –π–º–æ–≤—ñ—Ä–Ω–æ—Å—Ç–µ–π", "–ú–µ—Ç–æ–¥–∏ –æ–±—á–∏—Å–ª–µ–Ω—å", "–ú–µ—Ç–æ–¥–∏ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó —Ç–∞ –¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –æ–ø–µ—Ä–∞—Ü—ñ–π", 
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ —É –ø—Ä–∏–π–Ω—è—Ç—Ç—ñ —Ä—ñ—à–µ–Ω—å", "–°–∏—Å—Ç–µ–º–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ —Ç–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è", "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –ø—Ä–∏—Ä–æ–¥–Ω–∏—á–∏—Ö —ñ —Å–æ—Ü—ñ–∞–ª—å–Ω–æ-–µ–∫–æ–Ω–æ–º—ñ—á–Ω–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤", 
    "–ú–∞—Ç–µ–º–∞—Ç–∏—á–Ω—ñ –æ—Å–Ω–æ–≤–∏ –∑–∞—Ö–∏—Å—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó", "–Ü–Ω—Ç–µ–≥—Ä–∞–ª—å–Ω—ñ —Ä—ñ–≤–Ω—è–Ω–Ω—è —ñ –≤–∞—Ä—ñ–∞—Ü—ñ–π–Ω–µ —á–∏—Å–ª–µ–Ω–Ω—è", "–ê—Å–∏–º–ø—Ç–æ—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–û—Å–Ω–æ–≤–∏ –∞–Ω–∞–ª—ñ–∑—É –§—É—Ä'—î", "–û—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó —Å–æ–ª—ñ—Ç–æ–Ω—ñ–≤", "–ê–Ω–∞–ª—ñ–∑ –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –ø—Ä–æ—Ü–µ—Å—ñ–≤ —ñ –ª–∞–Ω—Ü—é–≥–∏ –ú–∞—Ä–∫–æ–≤–∞", 
    "–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –º–µ—Ç–æ–¥–∏ –æ–±—Ä–æ–±–∫–∏ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∏—Ö –¥–∞–Ω–∏—Ö", "–Ü—Å—Ç–æ—Ä—ñ—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ï–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", 
    "–ó–∞–≥–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", "–ú–µ—Ö–∞–Ω—ñ–∫–∞", "–ú–æ–ª–µ–∫—É–ª—è—Ä–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ —ñ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º—ñ–∫–∞", "–ï–ª–µ–∫—Ç—Ä–∏–∫–∞ —ñ –º–∞–≥–Ω–µ—Ç–∏–∑–º –û–ø—Ç–∏–∫–∞",
    "–ê—Ç–æ–º–Ω–∞ —ñ —è–¥–µ—Ä–Ω–∞ —Ñ—ñ–∑–∏–∫–∞", "–ü—Ä–∞–∫—Ç–∏–∫—É–º —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –∑–∞–¥–∞—á –∑ —Ñ—ñ–∑–∏–∫–∏", "–¢–µ–æ—Ä–µ—Ç–∏—á–Ω–∞ —Ñ—ñ–∑–∏–∫–∞",
    "–ö–ª–∞—Å–∏—á–Ω–∞ –º–µ—Ö–∞–Ω—ñ–∫–∞", "–ö–≤–∞–Ω—Ç–æ–≤–∞ –º–µ—Ö–∞–Ω—ñ–∫–∞", "–°—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ —ñ —Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º—ñ–∫–∞", "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ —Ç–µ–æ—Ä—ñ—è —Ä–µ—á–æ–≤–∏–Ω–∏", 
    "–§—ñ–∑–∏–∫–∞ —Ç–∞ –º–µ—Ç–æ–¥–∏–∫–∞ —ó—ó –Ω–∞–≤—á–∞–Ω–Ω—è —É –ª—ñ—Ü–µ—è—Ö / –∞–∫–∞–¥–µ–º—ñ—á–Ω–∏—Ö –ª—ñ—Ü–µ—è—Ö", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è —Å—É—á–∞—Å–Ω–æ—ó —Ñ—ñ–∑–∏–∫–∏, —Ç–µ—Ö–Ω—ñ–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", 
    "–§—ñ–∑–∏–∫–∞ –∂–∏–≤–∏—Ö —Å–∏—Å—Ç–µ–º", "–§—ñ–∑–∏—á–Ω—ñ –æ—Å–Ω–æ–≤–∏ —Ä–æ–±–æ—Ç–∏ –±—ñ–æ–º–µ–¥–∏—á–Ω–æ—ó —Ç–µ—Ö–Ω—ñ–∫–∏", "–ê—Å—Ç—Ä–æ—Ñ—ñ–∑–∏–∫–∞", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", 
    "–ü—Ä–∞–∫—Ç–∏–∫—É–º –∑ —Ñ—ñ–∑–∏—á–Ω–æ–≥–æ –µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É —Ç–∞ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—á–Ω–∏—Ö —Å–ø–æ—Å—Ç–µ—Ä–µ–∂–µ–Ω—å", "–°—É—á–∞—Å–Ω–µ –ø—Ä–∏—Ä–æ–¥–æ–∑–Ω–∞–≤—Å—Ç–≤–æ —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –π–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è",
    "–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ (–∑–∞–≥–∞–ª—å–Ω–∞)", "–Ü–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", "–®–∫—ñ–ª—å–Ω–∏–π –∫—É—Ä—Å —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö"
    "–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω–∞ –∫—É–ª—å—Ç—É—Ä–∞", "–û—Å–Ω–æ–≤–∏ —à—Ç—É—á–Ω–æ–≥–æ —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É", "–ú–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è –≤ –æ—Å–≤—ñ—Ç—ñ", "–ü—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", 
    "–°—É—á–∞—Å–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, –º–∞—à–∏–Ω–Ω–µ –Ω–∞–≤—á–∞–Ω–Ω—è —Ç–∞ –®–Ü –≤ –æ—Å–≤—ñ—Ç—ñ", "–ê–ª–≥–æ—Ä–∏—Ç–º–∏ —ñ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –¥–∞–Ω–∏—Ö",
    "–û—Å–Ω–æ–≤–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–≥–æ —Ç–∞ –æ–±'—î–∫—Ç–Ω–æ-–æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", "–û—Å–Ω–æ–≤–∏ –≤–µ–±-–ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è",
    "–ü–æ–±—É–¥–æ–≤–∞ —Ç–∞ –∞–Ω–∞–ª—ñ–∑ –∞–ª–≥–æ—Ä–∏—Ç–º—ñ–≤ —É —à–∫—ñ–ª—å–Ω—ñ–π —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏—Ü—ñ", "–û–ø–µ—Ä–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ —Ç–∞ –º–µ—Ä–µ–∂–µ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –≤ —à–∫—ñ–ª—å–Ω–æ–º—É –∫—É—Ä—Å—ñ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏",
    "–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ —Ç–∞ –ø—Ä–æ–≥—Ä–∞–º–Ω–µ –∑–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö —Å–∏—Å—Ç–µ–º", "–ë–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ–π–Ω—ñ —Å–∏—Å—Ç–µ–º–∏",
    "–°–∏—Å—Ç–µ–º–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è –±–∞–∑–∞–º–∏ –¥–∞–Ω–∏—Ö", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–æ –æ—Ä—ñ—î–Ω—Ç–æ–≤–∞–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è / –≤ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω—ñ–π –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ", 
    "–¶–∏—Ñ—Ä–æ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –æ–±—Ä–æ–±–∫–∏ –≥—Ä–∞—Ñ—ñ—á–Ω–∏—Ö –∑–æ–±—Ä–∞–∂–µ–Ω—å, –∞–Ω—ñ–º–∞—Ü—ñ—ó —Ç–∞ –≤—ñ–¥–µ–æ", "–¶–∏—Ñ—Ä–æ–≤—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞—É–∫–æ–≤–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", 
    "–°–∏—Å—Ç–µ–º–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–æ—ó –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ö–æ–º–ø'—é—Ç–µ—Ä–Ω–µ –º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º —ñ –ø—Ä–æ—Ü–µ—Å—ñ–≤", "3D-–º–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è", 
    "–û—Å–Ω–æ–≤–∏ –∫—ñ–±–µ—Ä–±–µ–∑–ø–µ–∫–∏", "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –∑–∞—Ö–∏—Å—Ç—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó", "–û—Å–Ω–æ–≤–∏ —Ä–æ–±–æ—Ç–æ—Ç–µ—Ö–Ω—ñ–∫–∏ —Ç–∞ –∫—Ä–µ–∞—Ç–∏–≤–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è", 
    "–ú–æ–±—ñ–ª—å–Ω—ñ –∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏ / —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó —É –Ω–∞–≤—á–∞–Ω–Ω—ñ", "–î–∏—Å—Ç–∞–Ω—Ü—ñ–π–Ω–∏–π —Å—É–ø—Ä–æ–≤—ñ–¥ —à–∫—ñ–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
    "–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∞", "–ü—Ä–æ–≥—Ä–∞–º–Ω—ñ –∑–∞—Å–æ–±–∏ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Å–ø—Ä—è–º—É–≤–∞–Ω–Ω—è", "–û—Å–Ω–æ–≤–∏ —Ç–µ–æ—Ä—ñ—ó —ñ–Ω—Ç–µ–ª–µ–∫—Ç—É–∞–ª—å–Ω–∏—Ö —Å–∏—Å—Ç–µ–º",
    "–ü–æ–≥–ª–∏–±–ª–µ–Ω–∏–π –∫—É—Ä—Å —à–∫—ñ–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–Ü–Ω–∫–ª—é–∑–∏–≤–Ω–∏–π –º–µ–¥—ñ–∞–ø—Ä–æ—Å—Ç—ñ—Ä: —î–≤—Ä–æ–ø–µ–π—Å—å–∫–∏–π –¥–æ—Å–≤—ñ–¥", 
    "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–ú–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏", 
    "–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏ —Ç–∞ –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó", "–¢–µ–æ—Ä—ñ—è —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è (–∞–ª–≥–µ–±—Ä–∏, —Å—Ç–µ—Ä–µ–æ–º–µ—Ç—Ä—ñ—ó)",
    "–ù–∞—É–∫–æ–≤—ñ –æ—Å–Ω–æ–≤–∏ –ø–æ–≥–ª–∏–±–ª–µ–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–¢–µ–æ—Ä—ñ—è —ñ –ø—Ä–∞–∫—Ç–∏–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–Ω–∏—Ö / —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏—á–Ω–∏—Ö –æ–ª—ñ–º–ø—ñ–∞–¥",
    "–ü—Ä–∞–∫—Ç–∏–∫—É–º —Ä–æ–∑–≤'—è–∑—É–≤–∞–Ω–Ω—è –æ–ª—ñ–º–ø—ñ–∞–¥–Ω–∏—Ö –∑–∞–¥–∞—á (–∞–ª–≥–µ–±—Ä–∞, –≥–µ–æ–º–µ—Ç—Ä—ñ—è)", "–í–∏–±—Ä–∞–Ω—ñ –ø–∏—Ç–∞–Ω–Ω—è —à–∫—ñ–ª—å–Ω–æ–≥–æ –∫—É—Ä—Å—É —Ñ—ñ–∑–∏–∫–∏ / –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–ú–µ—Ç–æ–¥–æ–ª–æ–≥—ñ—è —ñ –º–µ—Ç–æ–¥–∏–∫–∞ –Ω–∞—É–∫–æ–≤–∏—Ö –¥–æ—Å–ª—ñ–¥–∂–µ–Ω—å", "–ü–µ–¥–∞–≥–æ–≥—ñ–∫–∞ —ñ –ø—Å–∏—Ö–æ–ª–æ–≥—ñ—è –≤–∏—â–æ—ó —à–∫–æ–ª–∏", "–û—Å–≤—ñ—Ç–æ–º–µ—Ç—Ä—ñ—è",
    "–ú–æ–¥–µ–ª—é–≤–∞–Ω–Ω—è –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ –≤–∏–∫–ª–∞–¥–∞—á–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ –ó–í–û", "–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥, –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Ç–∞ –æ—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –Ω–∞–≤—á–∞–Ω–Ω—è –∑ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", 
    "–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω—ñ —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –Ω–∞–≤—á–∞–ª—å–Ω–∏–º–∏ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ / –ø—Ä–æ—î–∫—Ç–Ω–æ—é –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—é", "–ú–µ—Ç–æ–¥–∏–∫–∞ —ñ–Ω–∫–ª—é–∑–∏–≤–Ω–æ–≥–æ –Ω–∞–≤—á–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏",
    "–î–æ—Å–ª—ñ–¥–Ω–∏—Ü—å–∫–æ-–ø—Ä–æ—î–∫—Ç—É–≤–∞–ª—å–Ω–∞ –¥—ñ—è–ª—å–Ω—ñ—Å—Ç—å –≤—á–∏—Ç–µ–ª—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏", "–Ü–Ω–Ω–æ–≤–∞—Ü—ñ–π–Ω–∏–π –ø–µ–¥–∞–≥–æ–≥—ñ—á–Ω–∏–π –¥–æ—Å–≤—ñ–¥ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏",
    "–¢–µ–æ—Ä—ñ—è —ñ –ø—Ä–∞–∫—Ç–∏–∫–∞ –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∏ –∑ —Ñ—ñ–∑–∏–∫–∏ –¥–æ –ó–ù–û", "–ü—Ä–∞–∫—Ç–∏–∫—É–º STEM-–µ–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—É"
]

# --- –î–ê–ù–Ü (–°—Ç—É–¥–µ–Ω—Ç–∏) ---
GROUPS_DATA = {
    "1–°–û–ú": ["–ê–ª–µ–∫—Å—î—î–Ω–∫–æ –ê–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ì–∞–π–¥–∞–π –ê–Ω–∞—Ç–æ–ª—ñ–π –û–ª–µ–≥–æ–≤–∏—á", "–ñ—É—Ä–±–µ–ª—é–∫ –ü–∞–≤–ª—ñ–Ω–∞ –ü–∞–≤–ª—ñ–≤–Ω–∞", "–ó–∞—Ä—É–¥–Ω—è–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ö–Ω–∏—à –î–µ–Ω–∏—Å –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ö—Ä–∞–ø–ª—è –õ—ñ–ª—ñ—è –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞", "–õ–æ–≥–∞—à–∫—ñ–Ω –î–µ–Ω–∏—Å –í–ª–∞–¥–∏—Å–ª–∞–≤–æ–≤–∏—á", "–ú–∞–∑—É—Ä –í–µ—Ä–æ–Ω—ñ–∫–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ú–µ–ª—å–Ω–∏–∫ –ë–æ–≥–¥–∞–Ω –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ü–µ—Ä–≤–∏–π –ê–Ω–¥—Ä—ñ–π –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–°—É–ª–∏–º–∞ –î–∞—Ä–∏–Ω–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", "–¢–∏–º–æ—à–µ–Ω–∫–æ –ú–∞—Ä—ñ—è –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–®–∞–ø–µ–ª—å—Å—å–∫–∞ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–®–µ–≤—á—É–∫ –ú–∞—Ä—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞"],
    "1–°–û–Ü": ["–õ–∏—Å–µ–Ω–∫–æ –¢–∏–º–æ—Ñ—ñ–π –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–õ—ñ–≤–∏–π –ü–∞–≤–ª–æ –í–ª–∞–¥–∏—Å–ª–∞–≤–æ–≤–∏—á", "–ú—É—Ä–µ–Ω–∫–æ –°—Ç–µ–ø–∞–Ω –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á", "–ü–æ—Å–ø–µ–ª–æ–≤ –ù–∞–∑–∞—Ä –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á", "–†–∏–±—á—É–∫ –ê–Ω–¥—Ä—ñ–π –û–ª–µ–≥–æ–≤–∏—á", "–¢–æ–º–∞—à–µ–≤—Å—å–∫–∏–π –ê—Ä—Ç–µ–º –í–∞—Å–∏–ª—å–æ–≤–∏—á"],
    "1–ú": ["–ë–∞—Å–∞—Ä–∞–±–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –Ü–≥–æ—Ä–æ–≤–∏—á", "–ë–æ–Ω–¥–∞—Ä –í–ª–∞–¥–∏—Å–ª–∞–≤ –í–∞—Å–∏–ª—å–æ–≤–∏—á", "–î–∞–Ω—å–∫–æ–≤—Å—å–∫–∏–π –ù—ñ–∫—ñ—Ç–∞ –ì–ª—ñ–±–æ–≤–∏—á", "–ö–æ–∫–∞—Ä—î–≤–∞ –í—ñ–∫—Ç–æ—Ä—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°—É–ª–∏–º–∞ –ú–∞—Ä–≥–∞—Ä—ñ—Ç–∞ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–¢–∏—à–∫—ñ–Ω–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –ü–∞–≤–ª—ñ–≤–Ω–∞"],
    "1–°–û–§–ê": ["–ì–µ–Ω—Å—ñ—Ü—å–∫–∞ –ê–ª—ñ–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ö—É—Ä—ñ–ª—å—á–µ–Ω–∫–æ –ö—ñ—Ä–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–ú–µ—Ü–≥–µ—Ä –ö–∞—Ç–µ—Ä–∏–Ω–∞ –í–∞–ª–µ—Ä—ñ—ó–≤–Ω–∞", "–ß–µ—Ä–Ω–µ—Ü—å–∫–∞ –ù–∞—Ç–∞–ª—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–®–≤–µ–¥—É–Ω –í–∞–ª–µ—Ä—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á"],
    "2–°–û–ú": ["–ê–¥–∞–º–ª—é–∫ –í–ª–∞–¥–∏—Å–ª–∞–≤ –†–æ–º–∞–Ω–æ–≤–∏—á", "–ë–∏—á–∫–æ –î–∞—Ä'—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ë—É–≥—Ä–æ–≤–∞ –Æ–ª—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–ë—É—Ä–µ–π–∫–æ –í–æ–ª–æ–¥–∏–º–∏—Ä –û–º–µ–ª—è–Ω–æ–≤–∏—á", "–ì–æ–Ω—á–∞—Ä—É–∫ –ê–Ω–≥–µ–ª—ñ–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ì—Ä—ñ—â–µ–Ω–∫–æ –°–≤—ñ—Ç–ª–∞–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–ì—É–Ω—å–∫–æ –Ü–≤–∞–Ω –†–æ–º–∞–Ω–æ–≤–∏—á", "–î–æ—Ä–æ—à –†—É—Å–ª–∞–Ω –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–ñ—É—Ä–∞–≤–µ–ª—å –ê–ª—å–æ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–ó—ñ–Ω—á–µ–Ω–∫–æ –ú–∞–∫—Å–∏–º –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–ö–∞–ª—ñ–Ω—ñ–Ω –Ñ–≤–≥–µ–Ω –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ö–∏—Å—ñ–ª—å –Ø–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞", "–ö–∏—Ü—è –Ø—Ä–æ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–ö—Ä–∞–≤—á—É–∫ –Æ–ª—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ú–∞—Ä—Ç–∏–Ω—é–∫ –î—ñ–∞–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ù–∞–∑–∞—Ä—É–∫ –î—ñ–∞–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞", "–ü–∞—Å—ñ—á–Ω–∏–∫ –°–æ—Ñ—ñ—è –ù–∞–∑–∞—Ä—ñ–≤–Ω–∞", "–ü—É—Å—Ç–æ–≤—ñ—Ç –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–ü—É—á–∫–æ–≤–∞ –í–∞–ª–µ—Ä—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–°–∏—á—É–∫ –ê–Ω–≥–µ–ª—ñ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°–ª–æ–±–æ–¥—è–Ω—é–∫ –í—ñ–∫—Ç–æ—Ä—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–°—Ç–∞—Å—å–∫–æ–≤–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞", "–•–∞—Ä–∫–µ–≤–∏—á –†—É—Å–ª–∞–Ω –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ß–µ—Ä–µ—à–Ω—è –°—Ç–∞–Ω—ñ—Å–ª–∞–≤ –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ß–æ—Ä–Ω–∞ –Ñ–ª–∏–∑–∞–≤–µ—Ç–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞"],
    "2–°–û–§–ê": ["–ú–∏–∫–æ–ª–∞–π—á—É–∫ –ú–∞–∫—Å–∏–º –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–§—É—Ä—Å—ñ–∫ –ú–∞—Ä—ñ—è –ú–∏—Ö–∞–π–ª—ñ–≤–Ω–∞"],
    "2–°–û–Ü": ["–ê–¥–∞–º–æ–≤ –í–ª–∞–¥–∏—Å–ª–∞–≤ –í–∏—Ç–∞–ª—ñ–π–æ–≤–∏—á", "–í–µ–∫—à–∏–Ω –Ü–≥–æ—Ä –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–î—ñ–¥–µ–Ω–∫–æ –ê—Ä—Ç–µ–º –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ö–∏—Ä–∏–ª—é–∫ –Ø—Ä–æ—Å–ª–∞–≤ –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ö—É–∑–æ–≤–ª—î–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ù–æ–≤–∞–∫ –õ—ñ–ª—ñ—è –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞", "–û—Å—Ç–∞–ø–æ–≤ –ê–Ω—Ç–æ–Ω –Æ—Ä—ñ–π–æ–≤–∏—á", "–¢–∞—Ä–∞–Ω—é–∫ –°—Ç–µ–ø–∞–Ω –Ñ–≤–≥–µ–Ω—ñ–π–æ–≤–∏—á", "–®–∏–ª–æ –ì–ª—ñ–± –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–®–ø–∞–∫ –î–∞—Ä'—è –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞"],
    "2–ú": ["–ë–ª–æ–Ω—Å—å–∫–∏–π –í–ª–∞–¥–∏—Å–ª–∞–≤ –Ø—Ä–æ—Å–ª–∞–≤–æ–≤–∏—á", "–ë–æ–Ω–¥–∞—Ä –ù–∞—Ç–∞–ª—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–ì–æ–ª–æ–≤–∞—Ç–∞ –í–∞–ª–µ—Ä—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ì—Ä–∞–∂–¥–∞–Ω –¢—ñ–º—É—Ä –ö–æ—Å—Ç—è–Ω—Ç–∏–Ω–æ–≤–∏—á", "–ì—É—Ü–æ–ª –ê–ª—å–æ–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–õ–µ–≤–µ–Ω–µ—Ü—å –í–ª–∞–¥–∏—Å–ª–∞–≤–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–õ–µ–≤—á–µ–Ω–∫–æ –ê–Ω–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ú–∏–∫–æ–ª–∞—î–Ω–∫–æ –î–º–∏—Ç—Ä–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–°–µ–º–µ–Ω—é–∫ –ê–Ω–≥–µ–ª—ñ–Ω–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–Ø—Ü—é–∫ –í—ñ–∫—Ç–æ—Ä—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞"],
    "3–°–û–ú": ["–í–∏–Ω–∞—Ä—á–∏–∫ –°–æ—Ñ—ñ—è –°—Ç–µ–ø–∞–Ω—ñ–≤–Ω–∞", "–í–æ–ª–∏–Ω—Å—å–∫–∞ –ê–Ω–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ö–ª–∞–Ω—Ü–∞—Ç–∏–π –ö–æ—Å—Ç—è–Ω—Ç–∏–Ω –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ö—Ä–∞–º–∞—Ä –ê–Ω–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ö—É–∑—å–º–µ–Ω–∫–æ –ö–∞—Ä–∏–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞", "–õ–∏—Å–∞–∫–æ–≤ –í—ñ—Ç–∞–ª—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–õ—É—á–∫–æ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–ú–∞—Ä—Ç–∏–Ω–µ–Ω–∫–æ –í–ª–∞–¥–∏—Å–ª–∞–≤ –Ü–≥–æ—Ä–æ–≤–∏—á", "–ú–∏—Ö–∞–π–ª–µ–Ω–∫–æ –í—ñ–∫—Ç–æ—Ä—ñ—è –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–ù–µ—Ñ–µ–¥–æ–≤–∞ –ö—Å–µ–Ω—ñ—è –Ñ–≤–≥–µ–Ω—ñ—ó–Ω–∞", "–ü–∞–ø–ª—ñ–Ω—Å—å–∫–∞ –Ü—Ä–∏–Ω–∞ –ü–µ—Ç—Ä—ñ–≤–Ω–∞", "–†—É–¥–∫–µ–≤–∏—á –û–ª—å–≥–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–°–µ—Ä–≤–µ—Ç–Ω—ñ–∫ –õ—ñ–ª—ñ—è –Ø—Ä–æ—Å–ª–∞–≤—ñ–≤–Ω–∞", "–£—Å–∞—Ç—é–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞", "–•–æ–≤–∞–Ω–µ—Ü—å –ú–∞—Ä º—è–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ß–µ—Ä–Ω—É—Ö–∞ –°–æ—Ñ—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–®–ø–æ—Ä—Ç–∫–æ –í—ñ–∫—Ç–æ—Ä—ñ—è –ú–∏—Ö–∞–π–ª—ñ–≤–Ω–∞"],
    "3–°–û–Ü": ["–ë–∞–±—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", "–î—ñ—Ö—Ç—è—Ä –í—ñ—Ç–∞–ª—ñ–π –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–î–æ–≤–∂–æ–∫ –í—ñ–∫—Ç–æ—Ä –ü–µ—Ç—Ä–æ–≤–∏—á", "–ö–∞–∑–∞–Ω–æ–∫ –Ñ–≥–æ—Ä –ú–∏—Ö–∞–π–ª–æ–≤–∏—á", "–ú–∞–∫–æ–≤—ñ—Ü—å–∫–∏–π –û–ª–µ–∫—Å—ñ–π –õ–µ–æ–Ω—ñ–¥–æ–≤–∏—á", "–ü–∏—Å—å–º–µ–Ω–Ω–∏–π –°–µ—Ä–≥—ñ–π –í–∞—Å–∏–ª—å–æ–≤–∏—á", "–†–µ–ø–µ–π –ê–Ω–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–°—Ç–∞–Ω–∫–µ–≤–∏—á –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–°—Ç—Ä–∞—Ç—ñ–π—á—É–∫ –Ü–≤–∞–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–®–∞—Ç–∫–æ–≤—Å—å–∫–∏–π –î–º–∏—Ç—Ä–æ –ü–µ—Ç—Ä–æ–≤–∏—á", "–®—É–º–∏–ª–æ –î–∞—Ä–∏–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞"],
    "3–°–û–§–ê": ["–ö–ª–∞–ø—É—â–∞–∫ –ë–æ–≥–¥–∞–Ω –í—ñ—Ç–∞–ª—ñ–π–æ–≤–∏—á", "–ü—Ä–∏—Å—è–∂–Ω—é–∫ –Ü–≤–∞–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°—Ç–∞—Å—é–∫ –í–∞–¥–∏–º –í–æ–ª—å–¥–µ–º–∞—Ä–æ–≤–∏—á", "–¢–µ—Ä–∞–∫—Ç –î–º–∏—Ç—Ä–æ –í–∞—Å–∏–ª—å–æ–≤–∏—á", "–•—ñ—Ö–ª–æ –Ü—Ä–∏–Ω–∞ –í–∞–ª–µ—Ä—ñ—ó–≤–Ω–∞"],
    "3–ú": ["–ë–∞—á–æ–∫ –ú–∏–∫–æ–ª–∞ –ü–µ—Ç—Ä–æ–≤–∏—á", "–ö–æ–±–µ—Ä–Ω–∏–∫ –Ü—Ä–∏–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ü–æ–ø—ñ–ª—å –Æ–ª—ñ–∞–Ω–∞ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–°–µ–º–µ–Ω–µ—Ü—å –í–µ—Ä–æ–Ω—ñ–∫–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–¶–∏—Ä—É–ª—å–Ω—ñ–∫–æ–≤–∞ –ú–∞—Ä–∏–Ω–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞"],
    "4–°–û–ú": ["–ì–æ–ª–æ–≤–∞—Ç–∞ –ú–∞—Ä–∏–Ω–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞", "–ì—Ä—ñ—â–µ–Ω–∫–æ –ê–Ω–¥—Ä—ñ–π –†—É—Å–ª–∞–Ω–æ–≤–∏—á", "–ö–ª—ñ—â –Æ–ª—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ú–∞—Ä—Ç–∏–Ω—é–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–ú–∞—Ö–æ–≤—Å—å–∫–∞ –í—ñ–∫—Ç–æ—Ä—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ú–æ—Ü–Ω–∞ –ú–∞—Ä—ñ—è –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞", "–ú—Ä—É–≥ –î–∞—Ä—ñ—è –í–∞–ª–µ–Ω—Ç–∏–Ω—ñ–≤–Ω–∞", "–ú—É–ª—è—Ä –ö–∞—Ä–∏–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ù–µ–≤—Ä—é—î–≤–∞ –î–∞—Ä'—è –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–ù–∏–∫–∏—Ç—é–∫ –Æ–ª—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–ü–∞–≤–ª–æ–≤–∞ –í—ñ–∫—Ç–æ—Ä—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–°–µ–≤–∞—Å—Ç—å—è–Ω–æ–≤–∞ –ö–∞—Ä—ñ–Ω–∞ –û–ª–µ–≥—ñ–≤–Ω–∞", "–°—Ç—Ä—É–±—á–µ–≤—Å—å–∫–∞ –î–∞—Ä'—è –í—è—á–µ—Å–ª–∞–≤—ñ–≤–Ω–∞", "–¢—ñ–º–æ—â–µ–Ω–∫–æ –Ü—Ä–∏–Ω–∞ –†–æ–º–∞–Ω—ñ–≤–Ω–∞", "–§–∞—à—Ç–∏–Ω—Å—å–∫–∞ –ú–∞—Ä—ñ—è –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–§—É—Ä–º–∞–Ω –ù–∞—Ç–∞–ª—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–•–æ–¥–∏–∫ –ê–ª—ñ–Ω–∞ –†–∞–¥—ñ–æ–Ω—ñ–≤–Ω–∞", "–®–≤–µ—Ü—å –ù–∞—Ç–∞–ª—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞"],
    "4–°–û–Ü": ["–ë–∞—Ä–∞–Ω–æ–≤—Å—å–∫–∏–π –ù—ñ–∫—ñ—Ç–∞ –Ø—Ä–æ—Å–ª–∞–≤–æ–≤–∏—á", "–í–∏—à–∫–æ–≤—Å—å–∫–∞ –í–µ—Ä–æ–Ω—ñ–∫–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–í–æ–≥–Ω–∏–∫ –í–ª–∞–¥–∏—Å–ª–∞–≤ –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–ó–æ–∑—É–ª—è –Æ–ª—ñ—è –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ö—Ä–∞—Å—ñ–ª–∏—á –ù–∞–∑–∞—Ä—ñ–π –Ñ–≤–≥–µ–Ω–æ–≤–∏—á", "–ú–∞–ª—å–æ–≤–∞–Ω–∏–π –í—ñ—Ç–∞–ª—ñ–π –í–∞–¥–∏–º–æ–≤–∏—á", "–ü–µ–ª–µ—à–æ–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–°–∞–≤—ñ–Ω–∞ –ö–∞—Ä–∏–Ω–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–°–æ—Ä–æ–∫–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–¢–∞–±–∞—à–Ω—é–∫ –ö–∞—Ä—ñ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–®–∏–∫—ñ—Ä –¢–∞—Ä–∞—Å –†–æ–º–∞–Ω–æ–≤–∏—á"],
    "4–ú": ["–ö–∞—Ä–Ω–∞—É—â—É–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –û–ª–µ–≥—ñ–≤–Ω–∞", "–ö–æ—Ü—é–±–∞–Ω –î—ñ–∞–Ω–∞ –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–ö–æ—Ü—é–±–∏–Ω—Å—å–∫–∞ –ê–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°–∞—ó–Ω—á—É–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –ü–∞–≤–ª—ñ–≤–Ω–∞", "–®–µ–ª—å–º–∞–Ω –õ—ñ–ª—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", "–Ø–∫–∏–º—á—É–∫ –ê–ª—ñ–Ω–∞ –Æ—Ä—ñ—ó–≤–Ω–∞"],
    "4–°–û–§–ê": ["–î–µ–ª—å–Ω–µ—Ü—å–∫–∏–π –Ü–≥–æ—Ä –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á", "–î–æ–≤–≥–∞–ª—å –ú–∞—Ä–∏–Ω–∞ –ì–µ–Ω–Ω–∞–¥—ñ—ó–≤–Ω–∞", "–ó–æ–∑—É–ª—è –°–æ—Ñ—ñ—è –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–ö–æ–≤–∞–ª–µ–Ω–∫–æ –ê–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ß–∞–ª–µ–Ω–∫–æ –û–ª—å–≥–∞ –í–æ–ª–æ–¥–∏–º–∏—Ä—ñ–≤–Ω–∞"],
    "1–ú–°–û–Ü": ["–ê—Ñ–∞–Ω–∞—Å—å—î–≤ –î–º–∏—Ç—Ä–æ –ê–Ω–¥—Ä—ñ–π–æ–≤–∏—á", "–ë—Ä–∏–∂–∞–∫ –í–ª–∞–¥–∏—Å–ª–∞–≤ –ê–Ω–∞—Ç–æ–ª—ñ–π–æ–≤–∏—á", "–í–∞–≤—à–∫–æ –í—ñ—Ç–∞–ª—ñ–π –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ö—ñ–∑—ñ–º –°—Ç–µ–ø–∞–Ω –í–∞–¥–∏–º–æ–≤–∏—á", "–ö–æ–≤–∞–ª–µ–Ω–∫–æ –ú–∞—Ä—ñ—á–∫–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ö–æ—Ä–æ–ª—å–æ–≤ –ú–∞–∫—Å–∏–º –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ú—É–ª—è—Ä—á—É–∫ –°–µ—Ä–≥—ñ–π –ü–∞–≤–ª–æ–≤–∏—á", "–ù–∏–∫–∏—Ç—é–∫ –î—ñ–∞–Ω–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω—ñ–≤–Ω–∞", "–†–∞–ø–ª—î–≤ –ê–Ω–¥—Ä—ñ–π –Ñ–≤–≥–µ–Ω–æ–≤–∏—á", "–®–µ–≤—á—É–∫ –Ñ–≤–≥–µ–Ω –Ü–≥–æ—Ä–æ–≤–∏—á"],
    "1–ú–ú": ["–ì–µ—Ç–º–∞–Ω—á—É–∫ –ê–Ω–Ω–∞ –í–∞–ª–µ–Ω—Ç–∏–Ω—ñ–≤–Ω–∞", "–ö—É—Ö—Ç–∞ –Ü–≤–∞–Ω–∫–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–°—Ç–µ—Å—é–∫ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–í–æ—Ä–æ–±–µ—Ü—å –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", "–ö—É–ª—ñ—à –û–ª–µ–∫—Å–∞–Ω–¥—Ä–∞ –†–æ–º–∞–Ω—ñ–≤–Ω–∞", "–õ–æ–≥–≤—ñ–Ω–µ–Ω–∫–æ –ì–∞–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–û–Ω–∏—â—É–∫ –û–ª–µ–∫—Å—ñ–π –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á", "–Æ—Ä—á—É–∫ –î–∞—Ä–∏–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞"],
    "1–ú–°–û–ú": ["–ö–æ–º–∞—Ä–æ–≤–∞ –ö–∞—Ä—ñ–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞", "–ó–ª–æ—Ç–∫–æ–≤—Å—å–∫–∞ –ê–ª–ª–∞ –í—ñ–ª–µ–Ω—ñ–≤–Ω–∞", "–¢–∞—Ä–∞–Ω—é–∫ –ù–∞–¥—ñ—è –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–ö–∞–∑–º—ñ—Ä—á—É–∫ –í–∞–ª–µ–Ω—Ç–∏–Ω–∞ –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–û—Å—Ç–∞–ø—á—É–∫ –î—ñ–∞–Ω–∞ –û–ª–µ–≥—ñ–≤–Ω–∞", "–ü–∞—à–∫—ñ–≤—Å—å–∫–∏–π –ë–æ–≥–¥–∞–Ω –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ú–∏—Ö–∞–π–ª—å–æ –õ—ñ–¥—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–¢–æ—Ä–∫–æ—Ç—é–∫ –Æ—Ä—ñ–π –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ö–ª–∏–º—á—É–∫ –ê–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–î—è—á—É–∫ –Ñ–≥–æ—Ä –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–Ü—Å—å–∫–æ–≤ –Ü–≥–æ—Ä –í–∞–ª–µ—Ä—ñ–π–æ–≤–∏—á", "–ë—Ä–∏—Ü–æ–≤–∞ –Ü–ª–æ–Ω–∞ –ë–æ–≥–¥–∞–Ω—ñ–≤–Ω–∞", "–†–æ–º–∞–Ω—å–∫–æ –û–ª–µ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ë—ñ–ª–∞ –ö–∞—Ä–∏–Ω–∞ –†—É—Å–ª–∞–Ω—ñ–≤–Ω–∞", "–ê–Ω—Ç–æ—à–∫–æ –ú–∞—Ä–∏–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ë–æ–Ω–¥–∞—Ä–µ–Ω–∫–æ –Ñ–ª–µ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ì—É—Ä–º–∞–Ω –ö–∞—Ç–µ—Ä–∏–Ω–∞ –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–î–æ–Ω—Å—å–∫–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–ü–æ—à—Ç–∞—Ä—É–∫ –°–Ω—ñ–∂–∞–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ë–∞–π–¥–∞ –ö–∞—Ä—ñ–Ω–∞ –Ü–≥–æ—Ä—ñ–≤–Ω–∞", "–ú–∞–º—á—É—Ä –ú–∏—Ä–æ—Å–ª–∞–≤–∞ –î–º–∏—Ç—Ä—ñ–≤–Ω–∞", "–°–∞–ª–∫–µ–≤–∏—á –î–∞—Ä–∏–Ω–∞ –†–æ–º–∞–Ω—ñ–≤–Ω–∞", "S–µ–º—á—É–∫ –û–ª–µ–≥ –í–∞—Å–∏–ª—å–æ–≤–∏—á"],
    "1–ú–°–û–§–ê": ["–ú—ñ—â–µ–Ω–∫–æ –í–ª–∞–¥–∏—Å–ª–∞–≤ –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ñ—É—Ä–∂–∞ –ê—Ä—Ç–µ–º –ê—Ä—Å–µ–Ω–æ–≤–∏—á", "–ë–µ—Ä–µ–∂–Ω–∞ –†–µ–≥—ñ–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–î–º–∏—Ç—Ä–µ–Ω–∫–æ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–î—Ä—ñ–º–∞ –í—ñ—Ç–∞–ª—ñ–π", "–û–ª–µ–∫—Å—ñ–π–∫–æ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –û–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á"],
    "2–ú–°–û–ú": ["–í–æ—Ä–æ–∂–∫–æ –í—ñ–∫—Ç–æ—Ä—ñ—è –û–ª–µ–∫—Å—ñ—ó–≤–Ω–∞", "–ì–æ–Ω—á–∞—Ä –°–µ—Ä–≥—ñ–π –í—ñ—Ç–∞–ª—ñ–π–æ–≤–∏—á", "–î–∑—é–Ω—è–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ó—ñ–Ω—è–∫ –Ü–≤–∞–Ω–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–Ü–≤–∞–Ω–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ö–µ–±–∞ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–ö–æ–∑—è—Ä—á—É–∫ –ö–∞—Ç–µ—Ä–∏–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–õ–µ—â–µ–Ω–∫–æ –¢–µ—Ç—è–Ω–∞ –¢–∏–º—É—Ä—ñ–≤–Ω–∞", "–ú–∏—Ö–∞–π–ª—é—Ç–∞ –û–ª–µ–Ω–∞ –í–∞—Å–∏–ª—ñ–≤–Ω–∞", "–†—É—Ç–∫–µ–≤–∏—á –¢–µ—Ç—è–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–†—è–±—É—Ö–∞ –í–µ—Ä–æ–Ω—ñ–∫–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–°–∏–¥–æ—Ä–µ–Ω–∫–æ –ê–Ω–Ω–∞ –û–ª–µ–∫—Å–∞–Ω–¥—Ä—ñ–≤–Ω–∞", "–¢–∏—â–µ–Ω–∫–æ –Ø–Ω–∞ –ú–∏—Ö–∞–π–ª—ñ–≤–Ω–∞", "–®—É—Ä–∏–Ω—è–∫ –û–ª–µ–∫—Å–∞–Ω–¥—Ä –Ü–≥–æ—Ä–æ–≤–∏—á"],
    "2–ú–°–û–§–ê": ["–ë—É—Å–µ–ª –°–æ—Ñ—ñ—è –Æ—Ä—ñ—ó–≤–Ω–∞", "–ì—É–ª–∏—á –ù–∞—Ç–∞–ª—ñ—è –†—É—Å–ª–∞–Ω—ñ–≤–Ω–∞", "–ö—É–ª—å–ø–µ–∫—ñ–Ω –Ü–≥–æ—Ä –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á", "–ú–∏—Ä–æ–Ω—é–∫ –ú–∞—Ä–∏–Ω–∞ –ê–Ω–∞—Ç–æ–ª—ñ—ó–≤–Ω–∞"],
    "2–ú–°–û–Ü": ["–ö–æ–ø—Ç—î–≤ –Ü–≤–∞–Ω –í–∞–ª–µ—Ä—ñ–π–æ–≤–∏—á", "–ö–æ—Å–µ–Ω—é–∫ –ú–∞—Ä–∫ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–¢–∞—Å–∫–∞—î–≤ –î–º–∏—Ç—Ä–æ –õ–µ–æ–Ω—ñ–¥–æ–≤–∏—á", "–®–µ–≤—á—É–∫ –ü–∞–≤–ª–æ –í—ñ–∫—Ç–æ—Ä–æ–≤–∏—á"],
    "2–ú–ú": ["–ì—Ä–∏—Ü–µ–Ω–∫–æ –í–æ–ª–æ–¥–∏–º–∏—Ä –ë–æ—Ä–∏—Å–æ–≤–∏—á", "–î—ñ–¥—É—Å–µ–Ω–∫–æ –ê–Ω–∞—Å—Ç–∞—Å—ñ—è –í—ñ–∫—Ç–æ—Ä—ñ–≤–Ω–∞", "–ö—ñ–∑—ñ–º –°—Ç–µ–ø–∞–Ω –í–∞–¥–∏–º–æ–≤–∏—á", "–ü—ñ–º–µ–Ω–æ–≤ –ê–Ω–¥—Ä—ñ–π –°–µ—Ä–≥—ñ–π–æ–≤–∏—á", "–ß–µ—Ä–Ω—ñ—î–Ω–∫–æ –ê—Ä—Ç–µ–º –í—ñ–∫—Ç–æ—Ä–æ–≤–∏—á"]
}

# --- –î–ê–ù–Ü (–í–∏–∫–ª–∞–¥–∞—á—ñ) ---
TEACHERS_DATA = {
    "–ö–∞—Ñ–µ–¥—Ä–∞ –∞–ª–≥–µ–±—Ä–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏": [
        "–ö–æ–Ω–æ—à–µ–≤—Å—å–∫–∏–π –û–ª–µ–≥ –õ–µ–æ–Ω—ñ–¥–æ–≤–∏—á (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ –∞–ª–≥–µ–±—Ä–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏)", "–ú–∞—Ç—è—à –û–ª—å–≥–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–ú–∏—Ö–∞–π–ª–µ–Ω–∫–æ –õ—é–±–æ–≤ –§–µ–¥–æ—Ä—ñ–≤–Ω–∞", "–í–æ—î–≤–æ–¥–∞ –ê–ª—ñ–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞ (–î–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, —Ñ—ñ–∑–∏–∫–∏ —ñ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö –Ω–∞—É–∫)",
        "–í–æ—Ç—è–∫–æ–≤–∞ –õ–µ—Å—è –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–ö–∞–ª–∞—à–Ω—ñ–∫–æ–≤ –Ü–≥–æ—Ä –í‚Äô—è—á–µ—Å–ª–∞–≤–æ–≤–∏—á", "–ù–∞–∫–æ–Ω–µ—á–Ω–∞ –õ—é–¥–º–∏–ª–∞ –ô–æ—Å–∏–ø—ñ–≤–Ω–∞", "–ü–∞–Ω–∞—Å–µ–Ω–∫–æ –û–ª–µ–∫—Å—ñ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –Ω–∞–≤—á–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏)",
        "–¢—é—Ç—é–Ω–Ω–∏–∫ –î—ñ–∞–Ω–∞ –û–ª–µ–≥—ñ–≤–Ω–∞", "–ö–æ–º–∞—Ä–æ–≤–∞ –ö–∞—Ä–∏–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞"
    ],
    "–ö–∞—Ñ–µ–¥—Ä–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏": [
        "–ö–æ–≤—Ç–æ–Ω—é–∫ –ú–∞—Ä'—è–Ω–∞ –ú–∏—Ö–∞–π–ª—ñ–≤–Ω–∞ (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏)", "–ë–∞–∫ –°–µ—Ä–≥—ñ–π –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –Ω–∞—É–∫–æ–≤–æ—ó —Ä–æ–±–æ—Ç–∏)", "–ö–ª–æ—á–∫–æ –û–∫—Å–∞–Ω–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞",
        "–ì—Ä–∞–Ω—è–∫ –í–∞–ª–µ—Ä—ñ–π –§–µ–¥–æ—Ä–æ–≤–∏—á", "–ö–æ–≤—Ç–æ–Ω—é–∫ –ì–∞–ª–∏–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ö–æ—Å–æ–≤–µ—Ü—å –û–ª–µ–Ω–∞ –ü–∞–≤–ª—ñ–≤–Ω–∞ (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –≤–∏—Ö–æ–≤–Ω–æ—ó —Ç–∞ —Å–æ—Ü—ñ–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏)", "–ö—Ä—É–ø—Å—å–∫–∏–π –Ø—Ä–æ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á",
        "–°–æ—è –û–ª–µ–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–¢—é—Ç—é–Ω –õ—é–±–æ–≤ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–õ–µ–æ–Ω–æ–≤–∞ –Ü–≤–∞–Ω–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ü–æ–ª—ñ—â—É–∫ –í—ñ—Ç–∞–ª—ñ–π –û–ª–µ–≥–æ–≤–∏—á", "–Ø—Ä–æ—à –û–∫—Å–∞–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞"
    ],
    "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ—ñ–∑–∏–∫–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó": [
        "–°—ñ–ª—å–≤–µ–π—Å—Ç—Ä –ê–Ω–∞—Ç–æ–ª—ñ–π –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ —Ñ—ñ–∑–∏–∫–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó)", "–ó–∞–±–æ–ª–æ—Ç–Ω–∏–π –í–æ–ª–æ–¥–∏–º–∏—Ä –§–µ–¥–æ—Ä–æ–≤–∏—á", "–ë—ñ–ª—é–∫ –ê–Ω–∞—Ç–æ–ª—ñ–π –Ü–≤–∞–Ω–æ–≤–∏—á",
        "–î—É–º–µ–Ω–∫–æ –í—ñ–∫—Ç–æ—Ä—ñ—è –ü–µ—Ç—Ä—ñ–≤–Ω–∞", "–ú–æ–∫–ª—é–∫ –ú–∏–∫–æ–ª–∞ –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ö—Å–µ–Ω–¥–∑–æ–≤–∞ –û–∫—Å–∞–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", "–ú–∞–º—ñ—á–µ–≤–∞ –Ü–Ω–Ω–∞ –û–ª–µ–∫—Å—ñ—ó–≤–Ω–∞",
        "–ú–æ—Ä–æ–∑ –Ø—Ä–æ—Å–ª–∞–≤ –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–°—ñ–≤–∞—î–≤–∞ –ù–∞—Ç–∞–ª—ñ—è –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞", "–ñ—É—Ä–∂–∞ –ê—Ä—Ç–µ–º –ê—Ä—Å–µ–Ω–æ–≤–∏—á"
    ]
}

# --- BACKEND ---
def make_hashes(password):
    return hashlib.sha256(str.encode(password)).hexdigest()

def check_hashes(password, hashed_text):
    if make_hashes(password) == hashed_text: return True
    return False

def create_connection():
    return sqlite3.connect('university_v22.db', check_same_thread=False)

def init_db():
    conn = create_connection()
    c = conn.cursor()
    c.execute('''CREATE TABLE IF NOT EXISTS users(username TEXT PRIMARY KEY, password TEXT, role TEXT, full_name TEXT, group_link TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS students(id INTEGER PRIMARY KEY AUTOINCREMENT, full_name TEXT, group_name TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS schedule(id INTEGER PRIMARY KEY AUTOINCREMENT, group_name TEXT, day TEXT, time TEXT, subject TEXT, teacher TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS documents(id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT, student_name TEXT, status TEXT, date TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS file_storage(id INTEGER PRIMARY KEY AUTOINCREMENT, filename TEXT, file_content BLOB, upload_date TEXT, uploader TEXT, subject TEXT, description TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS grades(id INTEGER PRIMARY KEY AUTOINCREMENT, student_name TEXT, group_name TEXT, subject TEXT, type_of_work TEXT, grade INTEGER, date TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS attendance(id INTEGER PRIMARY KEY AUTOINCREMENT, student_name TEXT, group_name TEXT, subject TEXT, date_column TEXT, status TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS news(id INTEGER PRIMARY KEY AUTOINCREMENT, title TEXT, message TEXT, author TEXT, date TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS dormitory(id INTEGER PRIMARY KEY AUTOINCREMENT, student_name TEXT, room_number TEXT, payment_status TEXT, comments TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS scholarship(id INTEGER PRIMARY KEY AUTOINCREMENT, student_name TEXT, type TEXT, amount INTEGER, status TEXT, date_assigned TEXT)''')
    c.execute('''CREATE TABLE IF NOT EXISTS system_logs(id INTEGER PRIMARY KEY AUTOINCREMENT, user TEXT, action TEXT, details TEXT, timestamp TEXT)''')
    
    # --- –¢–ê–ë–õ–ò–¶–Ü –î–õ–Ø –ê–ù–ö–ï–¢–ò –¢–ê –ö–û–ù–¢–†–ê–ö–¢–Ü–í ---
    c.execute('''CREATE TABLE IF NOT EXISTS student_education_info(
        student_name TEXT PRIMARY KEY,
        status TEXT, study_form TEXT, course INTEGER, is_contract TEXT,
        faculty TEXT, specialty TEXT, edu_program TEXT,
        referral_type TEXT, enterprise TEXT,
        enroll_protocol_num TEXT, enroll_order_num TEXT, enroll_condition TEXT,
        enroll_protocol_date TEXT, enroll_order_date TEXT, enroll_date TEXT,
        grad_order_num TEXT, grad_order_date TEXT, grad_date TEXT,
        student_id_card TEXT, gradebook_id TEXT, library_card TEXT,
        curator TEXT, last_modified TEXT
    )''')
    c.execute('''CREATE TABLE IF NOT EXISTS student_prev_education(
        student_name TEXT PRIMARY KEY,
        institution_name TEXT, institution_type TEXT,
        diploma_type TEXT, diploma_series TEXT, diploma_number TEXT,
        diploma_grades_summary TEXT, foreign_languages TEXT,
        last_modified TEXT
    )''')
    c.execute('''CREATE TABLE IF NOT EXISTS academic_certificates(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        student_name TEXT, cert_number TEXT, issue_date TEXT,
        source_institution TEXT, notes TEXT,
        added_by TEXT, added_date TEXT
    )''')
    c.execute('''CREATE TABLE IF NOT EXISTS individual_statements(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        student_name TEXT, subject TEXT, statement_type TEXT,
        reason TEXT, date_issued TEXT, status TEXT,
        created_by TEXT
    )''')
    c.execute('''CREATE TABLE IF NOT EXISTS student_contracts(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        student_name TEXT,
        contract_number TEXT,
        date_signed TEXT,
        end_date TEXT,
        total_amount REAL,
        paid_amount REAL,
        payment_status TEXT,
        notes TEXT
    )''')

    # --- –ù–û–í–ê –¢–ê–ë–õ–ò–¶–Ø: –ï–ö–ó–ê–ú–ï–ù–ê–¶–Ü–ô–ù–Ü –í–Ü–î–û–ú–û–°–¢–Ü (–°–ï–°–Ü–Ø) ---
    c.execute('''CREATE TABLE IF NOT EXISTS exam_sheets(
        id INTEGER PRIMARY KEY AUTOINCREMENT,
        sheet_number TEXT,
        group_name TEXT,
        subject TEXT,
        control_type TEXT,
        exam_date TEXT,
        examiner TEXT,
        status TEXT
    )''')

    conn.commit()

    c.execute('SELECT count(*) FROM students')
    if c.fetchone()[0] == 0:
        c.execute('INSERT OR IGNORE INTO users VALUES (?,?,?,?,?)', ('admin', make_hashes('admin'), 'admin', '–ì–æ–ª–æ–≤–Ω–∏–π –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä', ''))
        for group, names in GROUPS_DATA.items():
            for name in names:
                clean_name = name.lstrip("0123456789. ")
                c.execute('INSERT INTO students (full_name, group_name) VALUES (?,?)', (clean_name, group))
        conn.commit()
    return conn

def log_action(user, action, details):
    conn = create_connection()
    ts = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    conn.execute("INSERT INTO system_logs (user, action, details, timestamp) VALUES (?,?,?,?)", (user, action, details, ts))
    conn.commit()

def convert_df_to_csv(df):
    return df.to_csv(index=False).encode('utf-8-sig')

# --- –°–¢–û–†–Ü–ù–ö–ò ---

def login_register_page():
    st.header("üîê –í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è (–í–∏–∫–ª–∞–¥–∞—á)")
    action = st.radio("–û–±–µ—Ä—ñ—Ç—å –¥—ñ—é:", ["–í—Ö—ñ–¥", "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è"], horizontal=True)
    
    conn = create_connection()
    c = conn.cursor()

    # –ü–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ —Ç–µ—Ö. –∫–ª—é—á—ñ–≤ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø—Ä–∏ –≤—Ö–æ–¥—ñ
    ALLOWED_STAFF = ["teacher"]

    if action == "–í—Ö—ñ–¥":
        username = st.text_input("–õ–æ–≥—ñ–Ω")
        password = st.text_input("–ü–∞—Ä–æ–ª—å", type='password')
        
        if st.button("–£–≤—ñ–π—Ç–∏"):
            c.execute('SELECT * FROM users WHERE username=? AND password=?', (username, make_hashes(password)))
            user = c.fetchone()
            
            if user:
                if user[2] not in ALLOWED_STAFF:
                    st.error("–î–æ—Å—Ç—É–ø –æ–±–º–µ–∂–µ–Ω–æ. –¢—ñ–ª—å–∫–∏ –¥–ª—è –ø–µ—Ä—Å–æ–Ω–∞–ª—É!")
                else:
                    st.session_state['logged_in'] = True
                    st.session_state['username'] = user[0]
                    st.session_state['role'] = user[2]
                    st.session_state['full_name'] = user[3]
                    st.session_state['group'] = user[4]
                    
                    log_action(user[3], "Login", f"–í—Ö—ñ–¥ —É —Å–∏—Å—Ç–µ–º—É: {user[2]}")
                    st.success(f"–í—ñ—Ç–∞—î–º–æ, {user[3]}!")
                    st.rerun()
            else:
                st.error("–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å")

    elif action == "–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è":
        st.info("–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ –¥–ª—è –í–∏–∫–ª–∞–¥–∞—á—ñ–≤")
        new_user = st.text_input("–í–∏–≥–∞–¥–∞–π—Ç–µ –ª–æ–≥—ñ–Ω")
        new_pass = st.text_input("–í–∏–≥–∞–¥–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å", type='password')
        
        # –í–ò–î–ê–õ–ï–ù–û 'tech_admin' –∑—ñ —Å–ø–∏—Å–∫—É –≤–∏–±–æ—Ä—É –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó
        # –¢–µ–ø–µ—Ä –¥–æ—Å—Ç—É–ø–Ω—ñ –ª–∏—à–µ 'teacher'
        registration_roles = ["teacher"]
        role = st.selectbox("–í–∞—à–∞ –ø–æ—Å–∞–¥–∞ / –†–æ–ª—å", registration_roles)
        
        full_name = st.text_input("–í–∞—à–µ –ü–Ü–ë (–ø–æ–≤–Ω—ñ—Å—Ç—é)")
        group_link = "Staff/Admin"

        if st.button("–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è"):
            if new_user and new_pass and full_name:
                try:
                    c.execute('INSERT INTO users VALUES (?,?,?,?,?)', 
                              (new_user, make_hashes(new_pass), role, full_name, group_link))
                    conn.commit()
                    
                    log_action(full_name, "Registration", f"–ù–æ–≤–∏–π –∑–∞–ø–∏—Å: {role}")
                    st.success("–û–±–ª—ñ–∫–æ–≤–∏–π –∑–∞–ø–∏—Å —Å—Ç–≤–æ—Ä–µ–Ω–æ! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å —É –≤–∫–ª–∞–¥—Ü—ñ '–í—Ö—ñ–¥'.")
                except sqlite3.IntegrityError:
                    st.error("–¶–µ–π –ª–æ–≥—ñ–Ω –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π.")
            else:
                st.warning("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è.")

def main_panel():
    st.title("üè† –ì–æ–ª–æ–≤–Ω–∞ –ø–∞–Ω–µ–ª—å")
    st.markdown(f"### –í—ñ—Ç–∞—î–º–æ, {st.session_state['full_name']}!")
    conn = create_connection()
    
    st.divider()
    st.subheader("üìä –ê–Ω–∞–ª—ñ—Ç–∏–∫–∞ —Ç–∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞")
    kpi1, kpi2, kpi3 = st.columns(3)
    
    if st.session_state['role'] in ['student', 'starosta']:
        my_group = st.session_state['group']
        group_count = pd.read_sql_query(f"SELECT count(*) FROM students WHERE group_name='{my_group}'", conn).iloc[0,0]
        kpi1.metric("–ú–æ—è –≥—Ä—É–ø–∞", f"{group_count} —Å—Ç—É–¥.")
    else:
        total_students = pd.read_sql_query("SELECT count(*) FROM students", conn).iloc[0,0]
        kpi1.metric("–í—Å—å–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤", total_students)

    file_count = pd.read_sql_query("SELECT count(*) FROM file_storage", conn).iloc[0,0]
    kpi2.metric("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤", file_count)

    if st.session_state['role'] in ['student', 'starosta']:
        avg_q = f"SELECT avg(grade) FROM grades WHERE student_name='{st.session_state['full_name']}'"
    else:
        avg_q = "SELECT avg(grade) FROM grades"
    avg_val = pd.read_sql_query(avg_q, conn).iloc[0,0]
    avg_val = round(avg_val, 1) if avg_val else 0
    kpi3.metric("–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª", avg_val)

    col_chart1, col_chart2 = st.columns(2)
    with col_chart1:
        st.markdown("**üìà –£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å (–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª)**")
        if st.session_state['role'] in ['student', 'starosta']:
            query_chart = f"SELECT subject, avg(grade) as avg_grade FROM grades WHERE student_name='{st.session_state['full_name']}' GROUP BY subject"
        else:
            query_chart = "SELECT subject, avg(grade) as avg_grade FROM grades GROUP BY subject"
        df_chart = pd.read_sql_query(query_chart, conn)
        if not df_chart.empty: st.bar_chart(df_chart.set_index('subject'))
        else: st.info("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")

    with col_chart2:
        st.markdown("**üìâ –í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å**")
        q_att = f"SELECT status FROM attendance WHERE student_name='{st.session_state['full_name']}'" if st.session_state['role'] in ['student', 'starosta'] else "SELECT status FROM attendance"
        df_att = pd.read_sql_query(q_att, conn)
        if not df_att.empty:
            absent_count = df_att[df_att['status'] != ''].shape[0] 
            present_count = df_att[df_att['status'] == ''].shape[0] 
            att_data = pd.DataFrame({'–°—Ç–∞—Ç—É—Å': ['–ü—Ä–∏—Å—É—Ç–Ω—ñ–π', '–í—ñ–¥—Å—É—Ç–Ω—ñ–π/–Ü–Ω—à–µ'], '–ö—ñ–ª—å–∫—ñ—Å—Ç—å': [present_count, absent_count]})
            base = alt.Chart(att_data).encode(theta=alt.Theta("–ö—ñ–ª—å–∫—ñ—Å—Ç—å", stack=True))
            pie = base.mark_arc(outerRadius=120).encode(color=alt.Color("–°—Ç–∞—Ç—É—Å"), order=alt.Order("–ö—ñ–ª—å–∫—ñ—Å—Ç—å", sort="descending"), tooltip=["–°—Ç–∞—Ç—É—Å", "–ö—ñ–ª—å–∫—ñ—Å—Ç—å"])
            st.altair_chart(pie, use_container_width=True)
        else: st.info("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")

    st.divider()
    st.subheader("üì¢ –û–≥–æ–ª–æ—à–µ–Ω–Ω—è —Ç–∞ –ù–æ–≤–∏–Ω–∏")
    if st.session_state['role'] in TEACHER_LEVEL:
        with st.expander("üìù –î–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è"):
            with st.form("news_form"):
                n_title = st.text_input("–ó–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–æ–≤–∏–Ω–∏")
                n_msg = st.text_area("–¢–µ–∫—Å—Ç –æ–≥–æ–ª–æ—à–µ–Ω–Ω—è")
                if st.form_submit_button("–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏"):
                    if n_title and n_msg:
                        c = conn.cursor()
                        date_pub = datetime.now().strftime("%Y-%m-%d %H:%M")
                        c.execute("INSERT INTO news (title, message, author, date) VALUES (?,?,?,?)", (n_title, n_msg, st.session_state['full_name'], date_pub))
                        conn.commit()
                        st.success("–ù–æ–≤–∏–Ω—É –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ!")
                        st.rerun()
    news_df = pd.read_sql_query("SELECT title, message, author, date FROM news ORDER BY id DESC", conn)
    if not news_df.empty:
        for i, row in news_df.iterrows():
            with st.container(border=True):
                st.markdown(f"### {row['title']}")
                st.write(row['message'])
                st.caption(f"üóìÔ∏è {row['date']} | ‚úçÔ∏è {row['author']}")
    else: st.info("–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –∞–∫—Ç—É–∞–ª—å–Ω–∏—Ö –æ–≥–æ–ª–æ—à–µ–Ω—å.")

def students_groups_view():
    st.title("üë• –°—Ç—É–¥–µ–Ω—Ç–∏ —Ç–∞ –ì—Ä—É–ø–∏")
    conn = create_connection()
    all_groups = ["–í—Å—ñ"] + list(GROUPS_DATA.keys())
    selected_group = st.selectbox("–§—ñ–ª—å—Ç—Ä –ø–æ –≥—Ä—É–ø—ñ:", all_groups)
    query = "SELECT id, full_name as '–ü–Ü–ë', group_name as '–ì—Ä—É–ø–∞' FROM students"
    if selected_group != "–í—Å—ñ": query += f" WHERE group_name='{selected_group}'"
    df = pd.read_sql_query(query, conn)
    csv = convert_df_to_csv(df)
    st.download_button("‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ (CSV)", csv, "students.csv", "text/csv")
    st.dataframe(df, use_container_width=True)
    
    if st.session_state['role'] in DEAN_LEVEL:
        st.divider()
        st.subheader("üõ†Ô∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è")
        t1, t2, t3 = st.tabs(["‚ûï –î–æ–¥–∞—Ç–∏", "üì• –Ü–º–ø–æ—Ä—Ç", "üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏"])
        with t1:
            with st.form("add_s"):
                nm = st.text_input("–ü–Ü–ë")
                gr = st.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()))
                if st.form_submit_button("–î–æ–¥–∞—Ç–∏"):
                    c = conn.cursor()
                    c.execute('INSERT INTO students (full_name, group_name) VALUES (?,?)', (nm, gr))
                    conn.commit()
                    log_action(st.session_state['full_name'], "Add Student", f"–î–æ–¥–∞–Ω–æ: {nm} –≤ {gr}")
                    st.success("–î–æ–¥–∞–Ω–æ!")
                    st.rerun()
        with t2:
            if st.session_state['role'] in ['admin', 'dean']:
                f = st.file_uploader("CSV (full_name, group_name)", type="csv")
                if f:
                    try:
                        df_new = pd.read_csv(f)
                        df_new[['full_name', 'group_name']].to_sql('students', conn, if_exists='append', index=False)
                        st.success("–Ü–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!")
                        st.rerun()
                    except Exception as e: st.error(f"–ü–æ–º–∏–ª–∫–∞: {e}")
        with t3:
            if st.session_state['role'] in ['admin', 'dean']:
                ids = pd.read_sql("SELECT id, full_name FROM students", conn)
                s_del = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", ids.apply(lambda x: f"{x['id']}: {x['full_name']}", axis=1))
                if st.button("–í–∏–¥–∞–ª–∏—Ç–∏"):
                    sid = int(s_del.split(":")[0])
                    conn.execute("DELETE FROM students WHERE id=?", (sid,))
                    conn.commit()
                    st.success("–í–∏–¥–∞–ª–µ–Ω–æ")
                    st.rerun()

import streamlit as st

# --- –î–ê–ù–Ü (–í–∏–∫–ª–∞–¥–∞—á—ñ) ---
if 'teachers_data' not in st.session_state:
    st.session_state.teachers_data = {
        "–ö–∞—Ñ–µ–¥—Ä–∞ –∞–ª–≥–µ–±—Ä–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏": [
            "–ö–æ–Ω–æ—à–µ–≤—Å—å–∫–∏–π –û–ª–µ–≥ –õ–µ–æ–Ω—ñ–¥–æ–≤–∏—á (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ –∞–ª–≥–µ–±—Ä–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏)", 
            "–ú–∞—Ç—è—à –û–ª—å–≥–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞", "–ú–∏—Ö–∞–π–ª–µ–Ω–∫–æ –õ—é–±–æ–≤ –§–µ–¥–æ—Ä—ñ–≤–Ω–∞", 
            "–í–æ—î–≤–æ–¥–∞ –ê–ª—ñ–Ω–∞ –õ–µ–æ–Ω—ñ–¥—ñ–≤–Ω–∞ (–î–µ–∫–∞–Ω —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏, —Ñ—ñ–∑–∏–∫–∏ —ñ –∫–æ–º–ø'—é—Ç–µ—Ä–Ω–∏—Ö –Ω–∞—É–∫)",
            "–í–æ—Ç—è–∫–æ–≤–∞ –õ–µ—Å—è –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", "–ö–∞–ª–∞—à–Ω—ñ–∫–æ–≤ –Ü–≥–æ—Ä –í‚Äô—è—á–µ—Å–ª–∞–≤–æ–≤–∏—á", "–ù–∞–∫–æ–Ω–µ—á–Ω–∞ –õ—é–¥–º–∏–ª–∞ –ô–æ—Å–∏–ø—ñ–≤–Ω–∞", 
            "–ü–∞–Ω–∞—Å–µ–Ω–∫–æ –û–ª–µ–∫—Å—ñ–π –ë–æ—Ä–∏—Å–æ–≤–∏—á (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –Ω–∞–≤—á–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏)",
            "–¢—é—Ç—é–Ω–Ω–∏–∫ –î—ñ–∞–Ω–∞ –û–ª–µ–≥—ñ–≤–Ω–∞", "–ö–æ–º–∞—Ä–æ–≤–∞ –ö–∞—Ä–∏–Ω–∞ –í–∞–¥–∏–º—ñ–≤–Ω–∞"
        ],
        "–ö–∞—Ñ–µ–¥—Ä–∞ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏": [
            "–ö–æ–≤—Ç–æ–Ω—é–∫ –ú–∞—Ä'—è–Ω–∞ –ú–∏—Ö–∞–π–ª—ñ–≤–Ω–∞ (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ç–∏–∫–∏)", 
            "–ë–∞–∫ –°–µ—Ä–≥—ñ–π –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –Ω–∞—É–∫–æ–≤–æ—ó —Ä–æ–±–æ—Ç–∏)", "–ö–ª–æ—á–∫–æ –û–∫—Å–∞–Ω–∞ –í—ñ—Ç–∞–ª—ñ—ó–≤–Ω–∞",
            "–ì—Ä–∞–Ω—è–∫ –í–∞–ª–µ—Ä—ñ–π –§–µ–¥–æ—Ä–æ–≤–∏—á", "–ö–æ–≤—Ç–æ–Ω—é–∫ –ì–∞–ª–∏–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", 
            "–ö–æ—Å–æ–≤–µ—Ü—å –û–ª–µ–Ω–∞ –ü–∞–≤–ª—ñ–≤–Ω–∞ (–ó–∞—Å—Ç—É–ø–Ω–∏–∫ –¥–µ–∫–∞–Ω–∞ –∑ –≤–∏—Ö–æ–≤–Ω–æ—ó —Ç–∞ —Å–æ—Ü—ñ–∞–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏)", 
            "–ö—Ä—É–ø—Å—å–∫–∏–π –Ø—Ä–æ—Å–ª–∞–≤ –í–æ–ª–æ–¥–∏–º–∏—Ä–æ–≤–∏—á", "–°–æ—è –û–ª–µ–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–¢—é—Ç—é–Ω –õ—é–±–æ–≤ –ê–Ω–¥—Ä—ñ—ó–≤–Ω–∞", 
            "–õ–µ–æ–Ω–æ–≤–∞ –Ü–≤–∞–Ω–Ω–∞ –ú–∏–∫–æ–ª–∞—ó–≤–Ω–∞", "–ü–æ–ª—ñ—â—É–∫ –í—ñ—Ç–∞–ª—ñ–π –û–ª–µ–≥–æ–≤–∏—á", "–Ø—Ä–æ—à –û–∫—Å–∞–Ω–∞ –Ü–≤–∞–Ω—ñ–≤–Ω–∞"
        ],
        "–ö–∞—Ñ–µ–¥—Ä–∞ —Ñ—ñ–∑–∏–∫–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó": [
            "–°—ñ–ª—å–≤–µ–π—Å—Ç—Ä –ê–Ω–∞—Ç–æ–ª—ñ–π –ú–∏–∫–æ–ª–∞–π–æ–≤–∏—á (–ó–∞–≤—ñ–¥—É–≤–∞—á –∫–∞—Ñ–µ–¥—Ä–∏ —Ñ—ñ–∑–∏–∫–∏ —ñ –º–µ—Ç–æ–¥–∏–∫–∏ –Ω–∞–≤—á–∞–Ω–Ω—è —Ñ—ñ–∑–∏–∫–∏, –∞—Å—Ç—Ä–æ–Ω–æ–º—ñ—ó)", 
            "–ó–∞–±–æ–ª–æ—Ç–Ω–∏–π –í–æ–ª–æ–¥–∏–º–∏—Ä –§–µ–¥–æ—Ä–æ–≤–∏—á", "–ë—ñ–ª—é–∫ –ê–Ω–∞—Ç–æ–ª—ñ–π –Ü–≤–∞–Ω–æ–≤–∏—á",
            "–î—É–º–µ–Ω–∫–æ –í—ñ–∫—Ç–æ—Ä—ñ—è –ü–µ—Ç—Ä—ñ–≤–Ω–∞", "–ú–æ–∫–ª—é–∫ –ú–∏–∫–æ–ª–∞ –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–ö—Å–µ–Ω–¥–∑–æ–≤–∞ –û–∫—Å–∞–Ω–∞ –°–µ—Ä–≥—ñ—ó–≤–Ω–∞", 
            "–ú–∞–º—ñ—á–µ–≤–∞ –Ü–Ω–Ω–∞ –û–ª–µ–∫—Å—ñ—ó–≤–Ω–∞", "–ú–æ—Ä–æ–∑ –Ø—Ä–æ—Å–ª–∞–≤ –û–ª–µ–∫—Å—ñ–π–æ–≤–∏—á", "–°—ñ–≤–∞—î–≤–∞ –ù–∞—Ç–∞–ª—ñ—è –í–∏—Ç–∞–ª—ñ—ó–≤–Ω–∞", 
            "–ñ—É—Ä–∂–∞ –ê—Ä—Ç–µ–º –ê—Ä—Å–µ–Ω–æ–≤–∏—á"
        ]
    }

def teachers_view():
    st.title("üë®‚Äçüè´ –í–∏–∫–ª–∞–¥–∞—á—ñ")

    # --- 1. –†–û–ó–î–Ü–õ "–£–ü–†–ê–í–õ–Ü–ù–ù–Ø" ---
    st.markdown("### üõ†Ô∏è –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è")
    
    # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∫–ª–∞–¥–æ–∫ —è–∫ –Ω–∞ —Å–∫—Ä–∏–Ω—à–æ—Ç—ñ
    tab_add, tab_import, tab_delete = st.tabs(["‚ûï –î–æ–¥–∞—Ç–∏", "üì• –Ü–º–ø–æ—Ä—Ç", "üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏"])

    with tab_add:
        with st.container(border=True): # –°—Ç–≤–æ—Ä—é—î –±—ñ–ª—É –∫–∞—Ä—Ç–∫—É —è–∫ –Ω–∞ —Ñ–æ—Ç–æ
            new_pib = st.text_input("–ü–Ü–ë", placeholder="–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è –ü–æ –±–∞—Ç—å–∫–æ–≤—ñ")
            target_dept = st.selectbox("–ö–∞—Ñ–µ–¥—Ä–∞", list(st.session_state.teachers_data.keys()))
            if st.button("–î–æ–¥–∞—Ç–∏", type="secondary"):
                if new_pib:
                    st.session_state.teachers_data[target_dept].insert(0, new_pib)
                    st.success(f"–í–∏–∫–ª–∞–¥–∞—á–∞ {new_pib} —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!")
                    st.rerun()
                else:
                    st.error("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –ü–Ü–ë.")

    with tab_import:
        st.info("–í–∏–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª —Ñ–æ—Ä–º–∞—Ç—ñ–≤ .csv –∞–±–æ .xlsx –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É —Å–ø–∏—Å–∫—É –≤–∏–∫–ª–∞–¥–∞—á—ñ–≤.")
        st.file_uploader("–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª", type=["csv", "xlsx"])

    with tab_delete:
        st.warning("–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–∫–æ–Ω–∫—É –∫–æ—à–∏–∫–∞ üóëÔ∏è –±—ñ–ª—è –ø—Ä—ñ–∑–≤–∏—â–∞ –≤–∏–∫–ª–∞–¥–∞—á–∞ —É —Å–ø–∏—Å–∫—É –Ω–∏–∂—á–µ.")

    st.divider()

    # --- 2. –°–ü–ò–°–û–ö –ö–ê–§–ï–î–† –¢–ê –í–ò–ö–õ–ê–î–ê–ß–Ü–í (–ó —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ Admin) ---
    for dept, teachers in st.session_state.teachers_data.items():
        with st.expander(f"üìö {dept}", expanded=True):
            
            if st.button(f"‚ûï –î–æ–¥–∞—Ç–∏ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫–∞ –¥–æ: {dept[:20]}...", key=f"fast_add_{dept}"):
                st.info("–ë—É–¥—å –ª–∞—Å–∫–∞, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —Ñ–æ—Ä–º–æ—é '–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è' –≤–≥–æ—Ä—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏.")

            for i, t in enumerate(teachers):
                col_text, col_edit, col_del = st.columns([0.8, 0.05, 0.05])
                
                with col_text:
                    st.write(f"- {t}")
                
                with col_edit:
                    if st.button("‚úèÔ∏è", key=f"edit_{dept}_{i}"):
                        st.toast(f"–†–µ–∂–∏–º —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –¥–ª—è: {t}")
                
                with col_del:
                    if st.button("üóëÔ∏è", key=f"del_{dept}_{i}"):
                        st.session_state.teachers_data[dept].pop(i)
                        st.rerun()

import pandas as pd
import io
import streamlit as st

def schedule_view():
    st.title("üìÖ –†–æ–∑–∫–ª–∞–¥")
    conn = create_connection()
    
    # –í–∏–±—ñ—Ä –≥—Ä—É–ø–∏
    grp = st.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()))
    
    # –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–∏—Ö –¥–∞–Ω–∏—Ö
    df = pd.read_sql_query(f"SELECT day, time, subject, teacher FROM schedule WHERE group_name='{grp}'", conn)
    
    if not df.empty:
        # --- –°–ï–ö–¶–Ü–Ø –ï–ö–°–ü–û–†–¢–£ ---
        st.subheader("üì§ –ï–∫—Å–ø–æ—Ä—Ç")
        c1, c2 = st.columns(2)
        
        # CSV –ï–∫—Å–ø–æ—Ä—Ç
        csv = df.to_csv(index=False).encode('utf-8-sig')
        c1.download_button("‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ CSV", csv, f"schedule_{grp}.csv", "text/csv")
        
        # Excel –ï–∫—Å–ø–æ—Ä—Ç
        towrite = io.BytesIO()
        df.to_excel(towrite, index=False, engine='xlsxwriter')
        towrite.seek(0)
        c2.download_button("üìä –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel", towrite, f"schedule_{grp}.xlsx", "application/vnd.ms-excel")
        
        st.table(df)
    else: 
        st.info("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")
    
    # --- –°–ï–ö–¶–Ü–Ø –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê ---
    if st.session_state.get('role') in DEAN_LEVEL:
        st.divider()
        
        # --- –Ü–ú–ü–û–†–¢ –§–ê–ô–õ–Ü–í ---
        st.subheader("üì• –Ü–º–ø–æ—Ä—Ç —Ñ–∞–π–ª—É")
        uploaded_file = st.file_uploader("–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª –¥–ª—è —ñ–º–ø–æ—Ä—Ç—É (CSV –∞–±–æ Excel)", type=['csv', 'xlsx'])
        
        if uploaded_file:
            try:
                if uploaded_file.name.endswith('.csv'):
                    new_data = pd.read_csv(uploaded_file)
                else:
                    new_data = pd.read_excel(uploaded_file)
                
                if st.button("üöÄ –ó–±–µ—Ä–µ–≥—Ç–∏ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ"):
                    new_data['group_name'] = grp
                    new_data.to_sql('schedule', conn, if_exists='append', index=False)
                    st.success("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!")
                    st.rerun()
            except Exception as e:
                st.error(f"–ü–æ–º–∏–ª–∫–∞ —Ñ–æ—Ä–º–∞—Ç—É: {e}")

        st.divider()

        # --- –†–£–ß–ù–ï –î–û–î–ê–í–ê–ù–ù–Ø (–í–∞—à–∞ —Ñ–æ—Ä–º–∞) ---
        with st.form("sch"):
            st.write("üìù –î–æ–¥–∞—Ç–∏ –∑–∞–ø–∏—Å –≤—Ä—É—á–Ω—É")
            d = st.selectbox("–î–µ–Ω—å", ["–ü–æ–Ω–µ–¥—ñ–ª–æ–∫", "–í—ñ–≤—Ç–æ—Ä–æ–∫", "–°–µ—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä", "–ü'—è—Ç–Ω–∏—Ü—è"])
            t = st.selectbox("–ß–∞—Å", ["08:30 - 09:50", "10:05 - 11:25", "11:40 - 13:00", "13:30 - 14:50", "15:00 - 16:20", "16:35 - 17:55"])
            s = st.text_input("–ü—Ä–µ–¥–º–µ—Ç")
            tch = st.text_input("–í–∏–∫–ª–∞–¥–∞—á", value=st.session_state.get('full_name', ''))
            
            if st.form_submit_button("–î–æ–¥–∞—Ç–∏"):
                if s:
                    conn.execute("INSERT INTO schedule (group_name, day, time, subject, teacher) VALUES (?,?,?,?,?)", (grp, d, t, s, tch))
                    conn.commit()
                    st.rerun()
                else:
                    st.error("–í–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –ø—Ä–µ–¥–º–µ—Ç–∞!")

def documents_view():
    st.title("üìÇ –î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±—ñ–≥ —Ç–∞ –ó–∞—è–≤–∏")
    conn = create_connection()
    
    # –í–∏–∑–Ω–∞—á–∞—î–º–æ —Å–ø–∏—Å–æ–∫ –≤–∫–ª–∞–¥–æ–∫. –¢–µ–ø–µ—Ä —ó—Ö –ª–∏—à–µ –¥–≤—ñ –æ—Å–Ω–æ–≤–Ω–∏—Ö
    tabs_list = ["üìÇ –†–µ—î—Å—Ç—Ä / –ú–æ—ó –∑–∞—è–≤–∏", "‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞—è–≤—É"]
    
    # –Ø–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á ‚Äî –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä, –¥–æ–¥–∞—î–º–æ –¢–†–ï–¢–Æ –≤–∫–ª–∞–¥–∫—É (—ñ–Ω–¥–µ–∫—Å 2)
    show_admin = st.session_state['role'] in DEAN_LEVEL
    if show_admin:
        tabs_list.append("‚öôÔ∏è –û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—ñ–≤")
    
    tabs = st.tabs(tabs_list)

    # --- –í–∫–ª–∞–¥–∫–∞ 0: –†–µ—î—Å—Ç—Ä ---
    with tabs[0]:
        st.subheader("–Ü—Å—Ç–æ—Ä—ñ—è –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤")
        if st.session_state['role'] in ['student', 'starosta']:
            query = f"SELECT id, title as '–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç—É', status as '–°—Ç–∞—Ç—É—Å', date as '–î–∞—Ç–∞ –ø–æ–¥–∞—á—ñ' FROM documents WHERE student_name='{st.session_state['full_name']}' ORDER BY id DESC"
        else:
            c1, c2 = st.columns([1, 3])
            filter_status = c1.selectbox("–§—ñ–ª—å—Ç—Ä –∑–∞ —Å—Ç–∞—Ç—É—Å–æ–º", ["–í—Å—ñ", "–û—á—ñ–∫—É—î", "–ì–æ—Ç–æ–≤–æ", "–í—ñ–¥—Ö–∏–ª–µ–Ω–æ"])
            base_q = "SELECT id, student_name as '–°—Ç—É–¥–µ–Ω—Ç', title as '–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç—É', status as '–°—Ç–∞—Ç—É—Å', date as '–î–∞—Ç–∞' FROM documents"
            query = f"{base_q} WHERE status LIKE '{filter_status}%' ORDER BY id DESC" if filter_status != "–í—Å—ñ" else f"{base_q} ORDER BY id DESC"
        
        try:
            df_docs = pd.read_sql(query, conn)
            if not df_docs.empty:
                st.dataframe(df_docs, use_container_width=True)
            else:
                st.info("–°–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ñ–≤ –ø–æ—Ä–æ–∂–Ω—ñ–π")
        except Exception as e:
            st.error(f"–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö: {e}")

    # --- –í–∫–ª–∞–¥–∫–∞ 1: –°—Ç–≤–æ—Ä–∏—Ç–∏ ---
    with tabs[1]:
        st.subheader("–ü–æ–¥–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Ç—É")
        with st.form("doc_create"):
            d_type = st.selectbox("–¢–∏–ø –¥–æ–∫—É–º–µ–Ω—Ç—É", [
                "–î–æ–≤—ñ–¥–∫–∞ –ø—Ä–æ –Ω–∞–≤—á–∞–Ω–Ω—è (–¥–ª—è –¢–¶–ö/–í—ñ–π—Å—å–∫–∫–æ–º–∞—Ç—É)",
                "–î–æ–≤—ñ–¥–∫–∞ –ø—Ä–æ –Ω–∞–≤—á–∞–Ω–Ω—è (–∑–∞ –º—ñ—Å—Ü–µ–º –≤–∏–º–æ–≥–∏)",
                "–î–æ–≤—ñ–¥–∫–∞ –ø—Ä–æ –¥–æ—Ö–æ–¥–∏",
                "–í–∏–ø–∏—Å–∫–∞ –∑ –æ—Ü—ñ–Ω–∫–∞–º–∏ (Transcript)",
                "–ó–∞—è–≤–∞ –Ω–∞ –º–∞—Ç–µ—Ä—ñ–∞–ª—å–Ω—É –¥–æ–ø–æ–º–æ–≥—É",
                "–ó–∞—è–≤–∞ –Ω–∞ –ø–æ—Å–µ–ª–µ–Ω–Ω—è –≤ –≥—É—Ä—Ç–æ–∂–∏—Ç–æ–∫",
                "–ó–∞—è–≤–∞ –Ω–∞ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫"
            ])
            d_comment = st.text_input("–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø—Ä–∏–º—ñ—Ç–∫–∏ (–Ω–∞–ø—Ä. '–í –¢–¶–ö –º. –í—ñ–Ω–Ω–∏—Ü—è' –∞–±–æ '–¢–µ—Ä–º—ñ–Ω–æ–≤–æ')")
            
            if st.form_submit_button("–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–∞–ø–∏—Ç"):
                full_title = f"{d_type}" + (f" ({d_comment})" if d_comment else "")
                conn.execute("INSERT INTO documents (title, student_name, status, date) VALUES (?,?,?,?)", 
                             (full_title, st.session_state['full_name'], "–û—á—ñ–∫—É—î", str(datetime.now().date())))
                conn.commit()
                st.success("–ó–∞–ø–∏—Ç —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!")
                st.rerun()

    # --- –í–∫–ª–∞–¥–∫–∞ 2: –û–±—Ä–æ–±–∫–∞ (–¢—É—Ç –±—É–ª–∞ –≥–æ–ª–æ–≤–Ω–∞ –ø–æ–º–∏–ª–∫–∞ IndexError) ---
    if show_admin:
        with tabs[2]: # –ó–º—ñ–Ω–µ–Ω–æ –∑ tabs[3] –Ω–∞ tabs[2]
            st.subheader("‚öôÔ∏è –û–±—Ä–æ–±–∫–∞ –∑–∞–ø–∏—Ç—ñ–≤ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤")
            pending_docs = pd.read_sql("SELECT id, student_name, title, date FROM documents WHERE status='–û—á—ñ–∫—É—î'", conn)
            
            if not pending_docs.empty:
                st.warning(f"–ù–µ–æ–±—Ä–æ–±–ª–µ–Ω–∏—Ö –∑–∞–ø–∏—Ç—ñ–≤: {len(pending_docs)}")
                req_id = st.selectbox("–û–±–µ—Ä—ñ—Ç—å –∑–∞–ø–∏—Ç", pending_docs['id'].tolist(), format_func=lambda x: f"ID {x}")
                sel_row = pending_docs[pending_docs['id']==req_id].iloc[0]
                
                with st.container(border=True):
                    st.markdown(f"**–°—Ç—É–¥–µ–Ω—Ç:** {sel_row['student_name']} | **–ó–∞–ø–∏—Ç:** {sel_row['title']}")
                    ac1, ac2 = st.columns(2)
                    new_status = ac1.selectbox("–†—ñ—à–µ–Ω–Ω—è", ["–ì–æ—Ç–æ–≤–æ", "–í—ñ–¥—Ö–∏–ª–µ–Ω–æ", "–í —Ä–æ–±–æ—Ç—ñ"])
                    admin_comment = ac2.text_input("–ö–æ–º–µ–Ω—Ç–∞—Ä", placeholder="–∫–∞–±. 205")
                    
                    if st.button("‚úÖ –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è"):
                        final_status = new_status + (f" ({admin_comment})" if admin_comment else "")
                        conn.execute("UPDATE documents SET status=? WHERE id=?", (final_status, req_id))
                        conn.commit()
                        st.success("–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ")
                        st.rerun()
            else:
                st.success("üéâ –í—Å—ñ –∑–∞–ø–∏—Ç–∏ –æ–ø—Ä–∞—Ü—å–æ–≤–∞–Ω–æ!")

def file_repository_view():
    st.title("üóÑÔ∏è –§–∞–π–ª–æ–≤–∏–π –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π")
    conn = create_connection()
    c = conn.cursor()
    col_f1, col_f2 = st.columns([2,1])
    with col_f1: filter_subj = st.selectbox("üìÇ –§—ñ–ª—å—Ç—Ä –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É", ["–í—Å—ñ"] + SUBJECTS_LIST)
    
    if st.session_state['role'] in TEACHER_LEVEL:
        with st.expander("üì§ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏"):
            with st.form("upload_form"):
                uploaded_file = st.file_uploader("–§–∞–π–ª", accept_multiple_files=False)
                f_subject = st.selectbox("–ü—Ä–µ–¥–º–µ—Ç", SUBJECTS_LIST)
                f_desc = st.text_input("–û–ø–∏—Å")
                if st.form_submit_button("–ó–±–µ—Ä–µ–≥—Ç–∏"):
                    if uploaded_file and f_desc:
                        c.execute("INSERT INTO file_storage (filename, file_content, upload_date, uploader, subject, description) VALUES (?,?,?,?,?,?)",
                                  (uploaded_file.name, uploaded_file.read(), datetime.now().strftime("%Y-%m-%d %H:%M"), st.session_state['full_name'], f_subject, f_desc))
                        conn.commit()
                        st.success("–ó–±–µ—Ä–µ–∂–µ–Ω–æ!")
                        st.rerun()
    query = "SELECT id, filename, subject, description, upload_date, uploader FROM file_storage"
    if filter_subj != "–í—Å—ñ": query += f" WHERE subject='{filter_subj}'"
    df_files = pd.read_sql_query(query, conn)
    if not df_files.empty:
        for s in df_files['subject'].unique():
            st.subheader(f"üìò {s}")
            for i, row in df_files[df_files['subject'] == s].iterrows():
                with st.container(border=True):
                    c1, c2, c3, c4 = st.columns([3, 4, 2, 1])
                    c1.write(f"üìÑ **{row['filename']}**")
                    c2.write(f"üìù {row['description']}")
                    c3.caption(f"{row['uploader']}")
                    data = c.execute("SELECT file_content FROM file_storage WHERE id=?", (row['id'],)).fetchone()[0]
                    c3.download_button("‚¨áÔ∏è", data, row['filename'], key=f"d{row['id']}")
                    if st.session_state['role'] == 'admin':
                        if c4.button("üóëÔ∏è", key=f"del_{row['id']}"):
                            c.execute("DELETE FROM file_storage WHERE id=?", (row['id'],))
                            conn.commit()
                            st.rerun()
    else: st.info("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")

import pandas as pd
import io
import streamlit as st

def gradebook_view():
    st.title("üíØ –ñ—É—Ä–Ω–∞–ª –û—Ü—ñ–Ω–æ–∫")
    conn = create_connection()
    c = conn.cursor()

    # –°–¢–£–î–ï–ù–¢ –¢–ê –°–¢–ê–†–û–°–¢–ê –¢–Ü–õ–¨–ö–ò –ß–ò–¢–ê–Æ–¢–¨ –°–í–û–á –û–¶–Ü–ù–ö–ò
    if st.session_state['role'] in ['student', 'starosta']:
        df = pd.read_sql(f"SELECT subject, type_of_work, grade, date FROM grades WHERE student_name='{st.session_state['full_name']}'", conn)
        st.dataframe(df, use_container_width=True)
    
    # –í–ò–ö–õ–ê–î–ê–ß–Ü, –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ò –¢–ê –¢–ï–•_–ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ò
    else:
        t_journal, t_ops = st.tabs(["–ñ—É—Ä–Ω–∞–ª", "üì•/üì§ –û–ø–µ—Ä–∞—Ü—ñ—ó"])
        
        # --- –§–Ü–õ–¨–¢–†–ò ---
        c1, c2, c3 = st.columns(3)
        grp = c1.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()))
        
        # –í–∏–±—ñ—Ä–∫–∞ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –¥–ª—è –æ–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏
        stds_df = pd.read_sql(f"SELECT full_name FROM students WHERE group_name='{grp}'", conn)
        students_in_group = stds_df['full_name'].tolist() if not stds_df.empty else []
        selected_student = c2.selectbox("–°—Ç—É–¥–µ–Ω—Ç", ["–í—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏"] + students_in_group)
        
        subj = c3.selectbox("–ü—Ä–µ–¥–º–µ—Ç", SUBJECTS_LIST)

        with t_journal:
            # –ë–ª–æ–∫ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–ª–æ–Ω–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–π –≤—Å—ñ–º –∫—Ä—ñ–º —Ç–µ—Ö_–∞–¥–º—ñ–Ω–∞ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
            # –Ø–∫—â–æ —Ç–µ—Ö_–∞–¥–º—ñ–Ω—É —Ç–µ–∂ –Ω–µ –º–æ–∂–Ω–∞ –¥–æ–¥–∞–≤–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫–∏, –º–æ–∂–Ω–∞ –æ–±–≥–æ—Ä–Ω—É—Ç–∏ –≤ if
            with st.expander("‚ûï –î–æ–¥–∞—Ç–∏ –∫–æ–ª–æ–Ω–∫—É"):
                with st.form("new_col"):
                    nm = st.text_input("–ù–∞–∑–≤–∞")
                    dt = st.date_input("–î–∞—Ç–∞")
                    if st.form_submit_button("–°—Ç–≤–æ—Ä–∏—Ç–∏"):
                        if nm and students_in_group:
                            for s in students_in_group:
                                c.execute("INSERT INTO grades (student_name, group_name, subject, type_of_work, grade, date) VALUES (?,?,?,?,?,?)", 
                                         (s, grp, subj, nm, 0, str(dt)))
                            conn.commit()
                            st.rerun()
                        else:
                            st.warning("–ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –Ω–∞–∑–≤—É –∞–±–æ –Ω–∞—è–≤–Ω—ñ—Å—Ç—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —É –≥—Ä—É–ø—ñ.")

            # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            query = f"SELECT student_name, type_of_work, grade FROM grades WHERE group_name='{grp}' AND subject='{subj}'"
            if selected_student != "–í—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏":
                query += f" AND student_name='{selected_student}'"
            
            raw = pd.read_sql(query, conn)

            # --- –õ–û–ì–Ü–ö–ê –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –¢–ê –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø ---
            if not raw.empty:
                matrix = raw.pivot_table(index='student_name', columns='type_of_work', values='grade', aggfunc='first').fillna(0)
                
                # –ü–ï–†–ï–í–Ü–†–ö–ê –†–û–õ–Ü: –¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
                if st.session_state['role'] == 'tech_admin':
                    st.info("‚ÑπÔ∏è –†–µ–∂–∏–º –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–ª—è –¢–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ.")
                    st.dataframe(matrix, use_container_width=True) # –ü—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≥–ª—è–¥
                
                # –ü–ï–†–ï–í–Ü–†–ö–ê –†–û–õ–Ü: –í–∏–∫–ª–∞–¥–∞—á –∞–±–æ –ê–¥–º—ñ–Ω
                else:
                    edited = st.data_editor(matrix, use_container_width=True)
                    if st.button("–ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏"):
                        for s_name, row in edited.iterrows():
                            for w_name, val in row.items():
                                c.execute("UPDATE grades SET grade=? WHERE student_name=? AND subject=? AND type_of_work=?", 
                                         (val, s_name, subj, w_name))
                        conn.commit()
                        st.success("–î–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ!")
            else: 
                st.info("–î–∞–Ω–∏—Ö –Ω–µ–º–∞—î. –î–æ–¥–∞–π—Ç–µ –∫–æ–ª–æ–Ω–∫—É.")

        # --- –í–ö–õ–ê–î–ö–ê –û–ü–ï–†–ê–¶–Ü–ô (–ï–∫—Å–ø–æ—Ä—Ç/–Ü–º–ø–æ—Ä—Ç) ---
        with t_ops:
            st.subheader("üì§ –ï–∫—Å–ø–æ—Ä—Ç")
            raw_export = pd.read_sql(f"SELECT * FROM grades WHERE group_name='{grp}' AND subject='{subj}'", conn)
            
            col_ex1, col_ex2 = st.columns(2)
            csv_data = raw_export.to_csv(index=False).encode('utf-8-sig')
            col_ex1.download_button("üìÑ –ï–∫—Å–ø–æ—Ä—Ç CSV", csv_data, "grades.csv", "text/csv")
            
            try:
                buffer = io.BytesIO()
                with pd.ExcelWriter(buffer, engine='xlsxwriter') as writer:
                    raw_export.to_excel(writer, index=False)
                col_ex2.download_button("üìä –ï–∫—Å–ø–æ—Ä—Ç Excel", buffer.getvalue(), "grades.xlsx")
            except Exception:
                col_ex2.info("Excel —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π (–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ CSV)")

            # –Ü–º–ø–æ—Ä—Ç (–∑–∞–∑–≤–∏—á–∞–π –¥–æ–∑–≤–æ–ª–µ–Ω–∏–π —Ç–µ—Ö_–∞–¥–º—ñ–Ω—É –¥–ª—è –Ω–∞–ª–∞–≥–æ–¥–∂–µ–Ω–Ω—è)
            st.divider()
            st.subheader("üì• –Ü–º–ø–æ—Ä—Ç")
            up_file = st.file_uploader("–û–±–µ—Ä—ñ—Ç—å —Ñ–∞–π–ª (CSV –∞–±–æ XLSX)", type=["csv", "xlsx"])
            
            if up_file and st.button("üöÄ –í–∏–∫–æ–Ω–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç"):
                try:
                    df_new = pd.read_csv(up_file) if up_file.name.endswith('.csv') else pd.read_excel(up_file)
                    df_new.to_sql('grades', conn, if_exists='append', index=False)
                    st.success("–£—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!")
                    st.rerun()
                except Exception as e:
                    st.error(f"–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: {e}")

import io
import pandas as pd
import streamlit as st

def attendance_view():
    st.title("üìù –ñ—É—Ä–Ω–∞–ª –í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ")
    conn = create_connection()
    
    # --- –õ–û–ì–Ü–ö–ê –î–õ–Ø –°–¢–£–î–ï–ù–¢–ê ---
    if st.session_state['role'] == 'student':
        df_att = pd.read_sql(
            f"SELECT subject as '–ü—Ä–µ–¥–º–µ—Ç', date_column as '–î–∞—Ç–∞', status as '–°—Ç–∞—Ç—É—Å' "
            f"FROM attendance WHERE student_name='{st.session_state['full_name']}'", 
            conn
        )
        st.dataframe(df_att, use_container_width=True)
        
    # --- –õ–û–ì–Ü–ö–ê –î–õ–Ø –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê / –í–ò–ö–õ–ê–î–ê–ß–ê ---
    else:
        # –í–∏–±—ñ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç—É: –ì—Ä—É–ø–∞ —Ç–∞ –ü—Ä–µ–¥–º–µ—Ç
        c1, c2 = st.columns(2)
        grp = c1.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()), key="att_grp")
        subj = c2.selectbox("–ü—Ä–µ–¥–º–µ—Ç", SUBJECTS_LIST, key="att_sbj")
        
        # --- –ë–õ–û–ö –î–û–î–ê–í–ê–ù–ù–Ø –¢–ê –Ü–ú–ü–û–†–¢–£ (–í–µ—Ä—Ö–Ω—è –ø–∞–Ω–µ–ª—å) ---
        col_add, col_imp = st.columns(2)
        
        with col_add:
            with st.expander("‚ûï –î–æ–¥–∞—Ç–∏ –¥–∞—Ç—É –≤—Ä—É—á–Ω—É"):
                with st.form("new_att_col"):
                    col_name = st.text_input("–ù–∞–∑–≤–∞ –¥–∞—Ç–∏ (–Ω–∞–ø—Ä. 25.12)")
                    
                    # –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –æ–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏
                    stds_in_grp = pd.read_sql(
                        f"SELECT full_name FROM students WHERE group_name='{grp}'", 
                        conn
                    )['full_name'].tolist()
                    
                    # –í–∏–±—ñ—Ä: –≤—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏ –∞–±–æ –æ–¥–∏–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π
                    student_selection = st.selectbox(
                        "–î–ª—è –∫–æ–≥–æ –¥–æ–¥–∞—Ç–∏:",
                        ["–£—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏"] + stds_in_grp
                    )
                    
                    default_status = st.selectbox(
                        "–°—Ç–∞—Ç—É—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º:",
                        ["", "–ø—Ä–∏—Å—É—Ç–Ω—ñ–π", "–Ω", "–Ω/–ø", "–∑"]
                    )
                    
                    if st.form_submit_button("–°—Ç–≤–æ—Ä–∏—Ç–∏"):
                        if col_name:
                            # –í–∏–∑–Ω–∞—á–∞—î–º–æ —Ü—ñ–ª—å–æ–≤–∏–π —Å–ø–∏—Å–æ–∫ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤
                            targets = stds_in_grp if student_selection == "–£—Å—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏" else [student_selection]
                            
                            for s in targets:
                                # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª—ñ–∫–∞—Ç–∏, —â–æ–± –Ω–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–¥–Ω—É –π —Ç—É —Å–∞–º—É –¥–∞—Ç—É –¥–≤—ñ—á—ñ
                                exists = conn.execute(
                                    "SELECT id FROM attendance WHERE student_name=? AND subject=? AND date_column=?", 
                                    (s, subj, col_name)
                                ).fetchone()
                                
                                if not exists:
                                    conn.execute(
                                        "INSERT INTO attendance (student_name, group_name, subject, date_column, status) VALUES (?,?,?,?,?)", 
                                        (s, grp, subj, col_name, default_status)
                                    )
                            conn.commit()
                            st.success(f"–ó–∞–ø–∏—Å–∏ –¥–ª—è '{col_name}' —É—Å–ø—ñ—à–Ω–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ!")
                            st.rerun()
                        else:
                            st.error("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–≤–µ–¥—ñ—Ç—å –Ω–∞–∑–≤—É –¥–∞—Ç–∏!")

        with col_imp:
            with st.expander("üì• –Ü–º–ø–æ—Ä—Ç –∑ Excel"):
                uploaded_file = st.file_uploader("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª .xlsx", type="xlsx")
                if uploaded_file:
                    imp_df = pd.read_excel(uploaded_file, index_col=0)
                    if st.button("–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ —ñ–º–ø–æ—Ä—Ç"):
                        for s_name, row in imp_df.iterrows():
                            for d_col, val in row.items():
                                val = str(val) if pd.notna(val) else ""
                                # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Å—É –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è
                                res = conn.execute(
                                    "SELECT id FROM attendance WHERE student_name=? AND subject=? AND date_column=?", 
                                    (s_name, subj, d_col)
                                ).fetchone()
                                
                                if res:
                                    conn.execute("UPDATE attendance SET status=? WHERE id=?", (val, res[0]))
                                else:
                                    conn.execute(
                                        "INSERT INTO attendance (student_name, group_name, subject, date_column, status) VALUES (?,?,?,?,?)", 
                                        (s_name, grp, subj, d_col, val)
                                    )
                        conn.commit()
                        st.success("–î–∞–Ω—ñ –∑ —Ñ–∞–π–ª—É —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω–æ!")
                        st.rerun()

        # --- –û–¢–†–ò–ú–ê–ù–ù–Ø –¢–ê –û–ë–†–û–ë–ö–ê –î–ê–ù–ò–• –î–õ–Ø –¢–ê–ë–õ–ò–¶–Ü ---
        raw = pd.read_sql(
            f"SELECT student_name, date_column, status FROM attendance WHERE group_name='{grp}' AND subject='{subj}'", 
            conn
        )
        
        if not raw.empty:
            # –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤–µ–¥–µ–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ (–ú–∞—Ç—Ä–∏—Ü—è: –°—Ç—É–¥–µ–Ω—Ç–∏ x –î–∞—Ç–∏)
            matrix = raw.pivot_table(index='student_name', columns='date_column', values='status', aggfunc='first').fillna("")
            
            st.divider()
            
            # –ü–∞–Ω–µ–ª—å –∞–Ω–∞–ª—ñ—Ç–∏–∫–∏ —Ç–∞ –µ–∫—Å–ø–æ—Ä—Ç—É
            f_col1, f_col2 = st.columns([2,1])
            
            with f_col1:
                # –†–∞—Ö—É—î–º–æ –ø—Ä–æ–ø—É—Å–∫–∏ "–Ω" (–Ω–µ–ø–æ–≤–∞–∂–Ω—ñ) –¥–ª—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó
                missed_counts = (matrix == "–Ω").sum(axis=1)
                max_misses = int(missed_counts.max()) if not missed_counts.empty else 0
                n_filter = st.slider("üîç –§—ñ–ª—å—Ç—Ä –ø—Ä–æ–≥—É–ª—å–Ω–∏–∫—ñ–≤: –°—Ç—É–¥–µ–Ω—Ç–∏ –∑ '–Ω' >= N:", 0, max_misses, 0)
            
            with f_col2:
                # –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è Excel-—Ñ–∞–π–ª—É
                buffer = io.BytesIO()
                with pd.ExcelWriter(buffer, engine='xlsxwriter') as writer:
                    matrix.to_excel(writer, sheet_name='–í—ñ–¥–≤—ñ–¥—É–≤–∞–Ω—ñ—Å—Ç—å')
                
                st.write("üì´ –ó–≤—ñ—Ç–Ω—ñ—Å—Ç—å")
                st.download_button(
                    label="üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ Excel",
                    data=buffer.getvalue(),
                    file_name=f"Attendance_{grp}_{subj}.xlsx",
                    mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    use_container_width=True
                )

            # –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è —Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –¥–æ –º–∞—Ç—Ä–∏—Ü—ñ
            filtered_matrix = matrix[missed_counts >= n_filter]

            # –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è —ñ–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∏—Ö —Å—Ç–æ–≤–ø—Ü—ñ–≤ –∑ –≤–∏–ø–∞–¥–∞—é—á–∏–º —Å–ø–∏—Å–∫–æ–º
            column_config = {
                col: st.column_config.SelectboxColumn(
                    col,
                    options=["", "–ø—Ä–∏—Å—É—Ç–Ω—ñ–π", "–Ω", "–Ω/–ø", "–∑"],
                    width="small"
                ) for col in filtered_matrix.columns
            }

            st.write(f"### üìã –ñ—É—Ä–Ω–∞–ª: {grp} ‚Äî {subj}")
            st.info("üí° –í–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω—é–≤–∞—Ç–∏ —Å—Ç–∞—Ç—É—Å–∏ –ø—Ä—è–º–æ –≤ —Ç–∞–±–ª–∏—Ü—ñ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—É—Ç–∏ –∫–Ω–æ–ø–∫—É '–ó–±–µ—Ä–µ–≥—Ç–∏' –≤–Ω–∏–∑—É.")
            
            # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ –¥–∞–Ω–∏—Ö
            edited = st.data_editor(
                filtered_matrix, 
                column_config=column_config,
                use_container_width=True
            )
            
            # –ö–Ω–æ–ø–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–º—ñ–Ω —É –ë–î
            if st.button("üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–º—ñ–Ω–∏ —É –∂—É—Ä–Ω–∞–ª—ñ"):
                for s_name, row in edited.iterrows():
                    for d_col, val in row.items():
                        # –ó–Ω–∞—Ö–æ–¥–∏–º–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π ID —Ä—è–¥–∫–∞ –≤ –ë–î –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
                        db_res = conn.execute(
                            "SELECT id FROM attendance WHERE student_name=? AND subject=? AND date_column=?", 
                            (s_name, subj, d_col)
                        ).fetchone()
                        
                        if db_res: 
                            conn.execute("UPDATE attendance SET status=? WHERE id=?", (val, db_res[0]))
                            
                conn.commit()
                st.success("–£—Å—ñ –∑–º—ñ–Ω–∏ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø–∏—Å–∞–Ω—ñ –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö!")
                st.rerun()
        else:
            st.info("–£ –∂—É—Ä–Ω–∞–ª—ñ –ø–æ–∫–∏ –Ω–µ–º–∞—î –¥–∞–Ω–∏—Ö –¥–ª—è –æ–±—Ä–∞–Ω–æ—ó –≥—Ä—É–ø–∏ —Ç–∞ –ø—Ä–µ–¥–º–µ—Ç–∞. –î–æ–¥–∞–π—Ç–µ –¥–∞—Ç—É –≤—Ä—É—á–Ω—É –∞–±–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ Excel-—Ñ–∞–π–ª.")

import pandas as pd
import io
import streamlit as st
from datetime import datetime

def reports_view():
    st.title("üìä –ó–≤—ñ—Ç–∏ —Ç–∞ –ü–æ—à—É–∫")
    conn = create_connection()
    c = conn.cursor()
    t1, t2, t3 = st.tabs(["üìã –í—ñ–¥–æ–º—ñ—Å—Ç—å (–ì—Ä—É–ø–∞/–ü—Ä–µ–¥–º–µ—Ç)", "üéì –ö–∞—Ä—Ç–∫–∞ –°—Ç—É–¥–µ–Ω—Ç–∞", "üìà –ó–≤–µ–¥–µ–Ω–∞ –≤—ñ–¥–æ–º—ñ—Å—Ç—å"])
    
    with t1:
        st.subheader("–§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–º–æ—Å—Ç—ñ")
        c1, c2 = st.columns(2)
        grp = c1.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()), key="rep_grp")
        subj = c2.selectbox("–ü—Ä–µ–¥–º–µ—Ç", SUBJECTS_LIST, key="rep_subj")
        
        raw = pd.read_sql(f"SELECT student_name, type_of_work, grade FROM grades WHERE group_name='{grp}' AND subject='{subj}'", conn)
        
        if not raw.empty:
            matrix = raw.pivot_table(index='student_name', columns='type_of_work', values='grade', aggfunc='first').fillna(0)
            st.dataframe(matrix, use_container_width=True)
            
            # --- –ë–õ–û–ö –ï–ö–°–ü–û–†–¢–£ ---
            st.markdown("#### –ï–∫—Å–ø–æ—Ä—Ç –≤—ñ–¥–æ–º–æ—Å—Ç—ñ")
            ex_c1, ex_c2, ex_c3 = st.columns(3)
            
            # CSV
            ex_c1.download_button("‚¨áÔ∏è CSV", matrix.to_csv().encode('utf-8-sig'), f"vidomist_{grp}_{subj}.csv", "text/csv")
            
            # Excel
            try:
                buf = io.BytesIO()
                with pd.ExcelWriter(buf, engine='xlsxwriter') as writer:
                    matrix.to_excel(writer, sheet_name='–í—ñ–¥–æ–º—ñ—Å—Ç—å')
                ex_c2.download_button("üìä Excel", buf.getvalue(), f"vidomist_{grp}_{subj}.xlsx", "application/vnd.ms-excel")
            except:
                ex_c2.info("Excel –¥–≤–∏–≥—É–Ω –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ")
                
            # JSON
            ex_c3.download_button("üìú JSON", matrix.to_json(force_ascii=False), f"vidomist_{grp}_{subj}.json", "application/json")
        else:
            st.warning("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")

    with t2:
        st.subheader("–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –ê–Ω–∫–µ—Ç–∞ –°—Ç—É–¥–µ–Ω—Ç–∞")
        all_students = pd.read_sql("SELECT full_name FROM students", conn)
        if not all_students.empty:
            selected_student = st.selectbox("–û–±–µ—Ä—ñ—Ç—å —Å—Ç—É–¥–µ–Ω—Ç–∞", all_students['full_name'].tolist())
            
            # –î–æ–¥–∞—î–º–æ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –µ–∫—Å–ø–æ—Ä—Ç—É –ø–æ–≤–Ω–æ—ó –∞–Ω–∫–µ—Ç–∏
            if st.button("üì§ –ï–∫—Å–ø–æ—Ä—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ –¥–∞–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞ (JSON)"):
                student_full_data = {
                    "main": pd.read_sql(f"SELECT * FROM students WHERE full_name='{selected_student}'", conn).to_dict('records'),
                    "edu": pd.read_sql(f"SELECT * FROM student_education_info WHERE student_name='{selected_student}'", conn).to_dict('records'),
                    "prev_edu": pd.read_sql(f"SELECT * FROM student_prev_education WHERE student_name='{selected_student}'", conn).to_dict('records'),
                    "grades": pd.read_sql(f"SELECT * FROM grades WHERE student_name='{selected_student}'", conn).to_dict('records')
                }
                st.download_button("–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ JSON –∞–Ω–∫–µ—Ç—É", str(student_full_data), f"anketa_{selected_student}.json")

            tab_main, tab_edu, tab_prev_edu, tab_grades = st.tabs(["–ó–∞–≥–∞–ª—å–Ω–∞", "–ù–∞–≤—á–∞–Ω–Ω—è (–ü–æ—Ç–æ—á–Ω–µ)", "–û—Å–≤—ñ—Ç–∞ (–î–æ –≤—Å—Ç—É–ø—É)", "–£—Å–ø—ñ—à–Ω—ñ—Å—Ç—å"])
            
            # ... (–í–∞—à —ñ—Å–Ω—É—é—á–∏–π –∫–æ–¥ –¥–ª—è tab_main, tab_edu, tab_prev_edu –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è –±–µ–∑ –∑–º—ñ–Ω) ...
            # [–¢—É—Ç –ª–æ–≥—ñ–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–æ—Ä–º, —è–∫—É –≤–∏ –Ω–∞–¥–∞–ª–∏]

            with tab_grades:
                grades = pd.read_sql(f"SELECT subject, type_of_work, grade, date FROM grades WHERE student_name='{selected_student}'", conn)
                if not grades.empty:
                    st.dataframe(grades, use_container_width=True)
                    st.metric("–°–µ—Ä–µ–¥–Ω—ñ–π –±–∞–ª", f"{grades['grade'].mean():.2f}")
                else: st.info("–û—Ü—ñ–Ω–æ–∫ –Ω–µ–º–∞—î.")
        else: st.error("–ù–∞—Ä–∞–∑—ñ –¥–∞–Ω—ñ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—ñ.")

    with t3:
        st.subheader("–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ó–≤–µ–¥–µ–Ω–æ—ó –í—ñ–¥–æ–º–æ—Å—Ç—ñ")
        
        # –û—Ç—Ä–∏–º—É—î–º–æ —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—å–æ –∑ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ —Ä–æ–∑–±—ñ–∂–Ω–æ—Å—Ç–µ–π
        try:
            db_groups = pd.read_sql("SELECT DISTINCT group_name FROM students", conn)['group_name'].tolist()
        except:
            db_groups = list(GROUPS_DATA.keys())
            
        grp_sum = st.selectbox("–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É", db_groups, key="rep_sum_grp")
        
        # --- –ë–õ–û–ö –Ü–ú–ü–û–†–¢–£ ---
        with st.expander("üì• –Ü–º–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö —É –∑–≤–µ–¥–µ–Ω—É –≤—ñ–¥–æ–º—ñ—Å—Ç—å"):
            up_file = st.file_uploader("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ CSV –∞–±–æ Excel", type=['csv', 'xlsx'], key="import_sum")
            if up_file and st.button("üöÄ –í–∏–∫–æ–Ω–∞—Ç–∏ —ñ–º–ø–æ—Ä—Ç"):
                try:
                    df_imp = pd.read_csv(up_file) if up_file.name.endswith('.csv') else pd.read_excel(up_file)
                    df_imp.to_sql('grades', conn, if_exists='append', index=False)
                    st.success("–î–∞–Ω—ñ —É—Å–ø—ñ—à–Ω–æ —ñ–º–ø–æ—Ä—Ç–æ–≤–∞–Ω—ñ!")
                    st.rerun()
                except Exception as e:
                    st.error(f"–ü–æ–º–∏–ª–∫–∞ —ñ–º–ø–æ—Ä—Ç—É: {e}")

        # –ë–µ–∑–ø–µ—á–Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —Å–∞–º–µ –¥–ª—è —Ü—ñ—î—ó –≥—Ä—É–ø–∏
        try:
            available_subjects_query = f"SELECT DISTINCT subject FROM grades WHERE group_name='{grp_sum}'"
            available_subjects = pd.read_sql(available_subjects_query, conn)['subject'].tolist()
        except:
            available_subjects = []

        if not available_subjects:
            available_subjects = SUBJECTS_LIST
            
        selected_subjects = st.multiselect("–û–±–µ—Ä—ñ—Ç—å –ø—Ä–µ–¥–º–µ—Ç–∏ –¥–ª—è –≤—ñ–¥–æ–º–æ—Å—Ç—ñ", options=available_subjects, default=available_subjects[:5] if len(available_subjects) > 5 else available_subjects)
        
        if st.button("üîÑ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ç–∞–±–ª–∏—Ü—é"):
            if selected_subjects:
                try:
                    # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–∏–π –∑–∞–ø–∏—Ç –¥–ª—è –±–µ–∑–ø–µ–∫–∏
                    subjects_placeholder = ",".join(["?"] * len(selected_subjects))
                    query = f"""
                        SELECT student_name, subject, AVG(grade) as final_grade 
                        FROM grades 
                        WHERE group_name = ? AND subject IN ({subjects_placeholder}) 
                        GROUP BY student_name, subject
                    """
                    params = [grp_sum] + selected_subjects
                    data = pd.read_sql(query, conn, params=params)
                    
                    if not data.empty:
                        # –§–æ—Ä–º—É—î–º–æ –º–∞—Ç—Ä–∏—Ü—é
                        summary_matrix = data.pivot_table(index='student_name', columns='subject', values='final_grade').fillna(0).round(0).astype(int)
                        
                        # –î–æ–¥–∞—î–º–æ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —É —è–∫–∏—Ö –Ω–µ–º–∞—î –æ—Ü—ñ–Ω–æ–∫ (—â–æ–± —Å–ø–∏—Å–æ–∫ –±—É–≤ –ø–æ–≤–Ω–∏–º)
                        all_students_df = pd.read_sql("SELECT full_name FROM students WHERE group_name=?", conn, params=[grp_sum])
                        summary_matrix = all_students_df.merge(summary_matrix, left_on='full_name', right_index=True, how='left').fillna(0)
                        summary_matrix.set_index('full_name', inplace=True)
                        
                        st.success(f"–ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–æ –≤—ñ–¥–æ–º—ñ—Å—Ç—å –¥–ª—è –≥—Ä—É–ø–∏ {grp_sum}")
                        st.dataframe(summary_matrix, use_container_width=True)
                        
                        # –ï–∫—Å–ø–æ—Ä—Ç
                        c_sum1, c_sum2 = st.columns(2)
                        csv_out = summary_matrix.to_csv().encode('utf-8-sig')
                        c_sum1.download_button("‚¨áÔ∏è –ï–∫—Å–ø–æ—Ä—Ç CSV", csv_out, f"zvedena_{grp_sum}.csv")
                        
                        try:
                            buf_sum = io.BytesIO()
                            with pd.ExcelWriter(buf_sum, engine='xlsxwriter') as writer:
                                summary_matrix.to_excel(writer)
                            c_sum2.download_button("üìä –ï–∫—Å–ø–æ—Ä—Ç Excel", buf_sum.getvalue(), f"zvedena_{grp_sum}.xlsx")
                        except:
                            c_sum2.warning("–î–ª—è –µ–∫—Å–ø–æ—Ä—Ç—É –≤ Excel –≤—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –±—ñ–±–ª—ñ–æ—Ç–µ–∫—É xlsxwriter")
                    else:
                        st.warning("–í –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –æ—Ü—ñ–Ω–æ–∫ –¥–ª—è –≤–∏–±—Ä–∞–Ω–∏—Ö –ø—Ä–µ–¥–º–µ—Ç—ñ–≤ —É —Ü—ñ–π –≥—Ä—É–ø—ñ.")
                except Exception as e:
                    st.error(f"–ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö: {e}")
                    st.info("–ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –¥–æ–¥–∞–ª–∏ –æ—Ü—ñ–Ω–∫–∏ –≤ '–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–º—É –∂—É—Ä–Ω–∞–ª—ñ'.")
            else:
                st.error("–ë—É–¥—å –ª–∞—Å–∫–∞, –æ–±–µ—Ä—ñ—Ç—å —Ö–æ—á–∞ –± –æ–¥–∏–Ω –ø—Ä–µ–¥–º–µ—Ç.")

def deanery_modules_view():
    st.title("–ú–æ–¥—É–ª—ñ –î–µ–∫–∞–Ω–∞—Ç—É")
    if st.session_state['role'] not in DEAN_LEVEL:
        st.error("–£ –≤–∞—Å –Ω–µ–º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ —Ü—ñ—î—ó –ø–∞–Ω–µ–ª—ñ.")
        return

    conn = create_connection()
    c = conn.cursor()

    tab1, tab2, tab3, tab4, tab5, tab6 = st.tabs(["üîÑ –Ñ–î–ï–ë–û", "üõèÔ∏è –ì—É—Ä—Ç–æ–∂–∏—Ç–æ–∫", "üí∞ –°—Ç–∏–ø–µ–Ω–¥—ñ—è", "üìú –ê–∫–∞–¥–µ–º. –î–æ–≤—ñ–¥–∫–∏", "üìù –Ü–Ω–¥. –í—ñ–¥–æ–º–æ—Å—Ç—ñ", "üìÑ –ö–æ–Ω—Ç—Ä–∞–∫—Ç–∏"])

    with tab1:
        st.header("–Ñ–¥–∏–Ω–∞ –¥–µ—Ä–∂–∞–≤–Ω–∞ –µ–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞ –±–∞–∑–∞ –∑ –ø–∏—Ç–∞–Ω—å –æ—Å–≤—ñ—Ç–∏")
        col_ex, col_im = st.columns(2)
        with col_ex:
            st.subheader("üì§ –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö")
            format_type = st.radio("–§–æ—Ä–º–∞—Ç –µ–∫—Å–ø–æ—Ä—Ç—É:", ["JSON", "XML (Beta)"])
            if st.button("–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Ñ–∞–π–ª –¥–ª—è –Ñ–î–ï–ë–û"):
                query = """SELECT s.full_name, s.group_name, u.role FROM students s LEFT JOIN users u ON s.full_name = u.full_name"""
                df_edebo = pd.read_sql(query, conn)
                if format_type == "JSON":
                    json_data = df_edebo.to_json(orient='records', force_ascii=False)
                    st.download_button(label="‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ JSON", data=json_data, file_name=f"edebo_export_{datetime.now().date()}.json", mime="application/json")
                else:
                    xml_data = df_edebo.to_csv(index=False) 
                    st.download_button(label="‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ XML/CSV", data=xml_data, file_name=f"edebo_export_{datetime.now().date()}.csv", mime="text/csv")
        with col_im:
            st.subheader("üì• –Ü–º–ø–æ—Ä—Ç –Ω–∞–∫–∞–∑—ñ–≤")
            uploaded_edebo = st.file_uploader("–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª –∑ –Ñ–î–ï–ë–û (JSON/XML)", type=['json', 'xml'])
            if uploaded_edebo:
                st.success("–§–∞–π–ª –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ.")

    with tab2:
        st.header("–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–æ—Å–µ–ª–µ–Ω–Ω—è–º")
        c1, c2 = st.columns([1, 2])
        with c1:
            with st.form("dorm_assign"):
                st.subheader("üè† –ü–æ—Å–µ–ª–µ–Ω–Ω—è")
                all_students = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
                student = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", all_students)
                room = st.text_input("–ù–æ–º–µ—Ä –∫—ñ–º–Ω–∞—Ç–∏", placeholder="–ù–∞–ø—Ä. 405-–ë")
                paid = st.checkbox("–û–ø–ª–∞—Ç–∞ –∑–∞ —Å–µ–º–µ—Å—Ç—Ä –≤–Ω–µ—Å–µ–Ω–∞?")
                comment = st.text_area("–ü—Ä–∏–º—ñ—Ç–∫–∞ (—Å—Ç–∞–Ω –∫—ñ–º–Ω–∞—Ç–∏/—ñ–Ω–≤–µ–Ω—Ç–∞—Ä)")
                if st.form_submit_button("–ó–±–µ—Ä–µ–≥—Ç–∏"):
                    status = "–û–ø–ª–∞—á–µ–Ω–æ" if paid else "–ë–æ—Ä–≥"
                    exists = c.execute("SELECT id FROM dormitory WHERE student_name=?", (student,)).fetchone()
                    if exists:
                        c.execute("UPDATE dormitory SET room_number=?, payment_status=?, comments=? WHERE student_name=?", (room, status, comment, student))
                        st.info("–î–∞–Ω—ñ –æ–Ω–æ–≤–ª–µ–Ω–æ!")
                    else:
                        c.execute("INSERT INTO dormitory (student_name, room_number, payment_status, comments) VALUES (?,?,?,?)", (student, room, status, comment))
                        st.success("–°—Ç—É–¥–µ–Ω—Ç–∞ –ø–æ—Å–µ–ª–µ–Ω–æ!")
                    conn.commit()
                    st.rerun()
        with c2:
            st.subheader("üìã –°–ø–∏—Å–∫–∏ –º–µ—à–∫–∞–Ω—Ü—ñ–≤")
            dorm_df = pd.read_sql("SELECT * FROM dormitory", conn)
            if not dorm_df.empty:
                def highlight_debt(val):
                    color = '#ff4b4b' if val == '–ë–æ—Ä–≥' else '#00cc66'
                    return f'color: {color}'
                st.dataframe(dorm_df.style.map(highlight_debt, subset=['payment_status']), use_container_width=True)
            else: st.info("–£ –≥—É—Ä—Ç–æ–∂–∏—Ç–∫—É –ø–æ–∫–∏ –Ω—ñ—Ö—Ç–æ –Ω–µ –∂–∏–≤–µ.")

    with tab3:
        st.header("–°—Ç–∏–ø–µ–Ω–¥—ñ–∞–ª—å–Ω–∞ –∫–æ–º—ñ—Å—ñ—è")
        st.markdown("#### üìä –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ —Ä–µ–π—Ç–∏–Ω–≥—É")
        if st.button("–û–Ω–æ–≤–∏—Ç–∏ —Ä–µ–π—Ç–∏–Ω–≥ —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ"):
            grade_query = "SELECT student_name, AVG(grade) as avg_score FROM grades GROUP BY student_name HAVING avg_score >= 4.0 ORDER BY avg_score DESC"
            rating_df = pd.read_sql(grade_query, conn)
            st.dataframe(rating_df, use_container_width=True)
            st.caption("*–ü–æ–∫–∞–∑–∞–Ω—ñ —Å—Ç—É–¥–µ–Ω—Ç–∏ –∑ –±–∞–ª–æ–º 4.0 —ñ –≤–∏—â–µ")
        st.divider()
        col_schol1, col_schol2 = st.columns(2)
        with col_schol1:
            with st.form("add_scholarship"):
                st.subheader("–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Å—Ç–∏–ø–µ–Ω–¥—ñ—ó")
                st_list = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
                sch_student = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", st_list, key="sch_st")
                sch_type = st.selectbox("–¢–∏–ø", ["–ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ (–ó–≤–∏—á–∞–π–Ω–∞)", "–ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ (–ü—ñ–¥–≤–∏—â–µ–Ω–∞)", "–°–æ—Ü—ñ–∞–ª—å–Ω–∞", "–ü—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å—å–∫–∞"])
                sch_amount = st.number_input("–°—É–º–∞ (–≥—Ä–Ω)", value=2000, step=100)
                if st.form_submit_button("–ü—Ä–∏–∑–Ω–∞—á–∏—Ç–∏"):
                    date_now = datetime.now().strftime("%Y-%m-%d")
                    c.execute("INSERT INTO scholarship (student_name, type, amount, status, date_assigned) VALUES (?,?,?,?,?)", 
                              (sch_student, sch_type, sch_amount, "–ê–∫—Ç–∏–≤–Ω–∞", date_now))
                    conn.commit()
                    st.success("–°—Ç–∏–ø–µ–Ω–¥—ñ—é –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ!")
                    st.rerun()
        with col_schol2:
            st.subheader("üí∞ –ê–∫—Ç–∏–≤–Ω—ñ —Å—Ç–∏–ø–µ–Ω–¥—ñ–∞—Ç–∏")
            sch_df = pd.read_sql("SELECT student_name, type, amount, status, date_assigned FROM scholarship", conn)
            if not sch_df.empty:
                st.dataframe(sch_df, use_container_width=True)
                total_budget = sch_df[sch_df['status']=='–ê–∫—Ç–∏–≤–Ω–∞']['amount'].sum()
                st.metric("–ú—ñ—Å—è—á–Ω–∏–π —Ñ–æ–Ω–¥ —Å—Ç–∏–ø–µ–Ω–¥—ñ–π", f"{total_budget} –≥—Ä–Ω")
            else: st.info("–°—Ç–∏–ø–µ–Ω–¥—ñ–π –Ω–µ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ.")

    with tab4:
        st.header("–ê–∫–∞–¥–µ–º—ñ—á–Ω—ñ –¥–æ–≤—ñ–¥–∫–∏ (–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è)")
        st.info("–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è –¥–æ–≤—ñ–¥–æ–∫ –≤—ñ–¥ —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤, —â–æ –ø–µ—Ä–µ–≤–µ–ª–∏—Å—è –∑ —ñ–Ω—à–∏—Ö –ó–í–û.")
        c_acad1, c_acad2 = st.columns(2)
        with c_acad1:
            with st.form("new_acad_cert"):
                st.subheader("‚ûï –ù–æ–≤–∞ –¥–æ–≤—ñ–¥–∫–∞")
                st_list_a = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
                s_name = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", st_list_a)
                cert_num = st.text_input("–ù–æ–º–µ—Ä –¥–æ–≤—ñ–¥–∫–∏")
                issue_dt = st.date_input("–î–∞—Ç–∞ –≤–∏–¥–∞—á—ñ")
                source = st.text_input("–ó–≤—ñ–¥–∫–∏ –≤–∏–¥–∞–Ω–∞ (–ó–í–û/–§–∞–∫—É–ª—å—Ç–µ—Ç)")
                notes = st.text_area("–î–µ—Ç–∞–ª—ñ (–∫—Ä–µ–¥–∏—Ç–∏, –ø—Ä–µ–¥–º–µ—Ç–∏)")
                if st.form_submit_button("–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏ –¥–æ–≤—ñ–¥–∫—É"):
                    c.execute("INSERT INTO academic_certificates (student_name, cert_number, issue_date, source_institution, notes, added_by, added_date) VALUES (?,?,?,?,?,?,?)",
                              (s_name, cert_num, str(issue_dt), source, notes, st.session_state['full_name'], str(datetime.now().date())))
                    conn.commit()
                    st.success("–î–æ–≤—ñ–¥–∫—É –¥–æ–¥–∞–Ω–æ!")
                    st.rerun()
        with c_acad2:
            st.subheader("üóÇÔ∏è –†–µ—î—Å—Ç—Ä –¥–æ–≤—ñ–¥–æ–∫")
            df_certs = pd.read_sql("SELECT * FROM academic_certificates", conn)
            st.dataframe(df_certs, use_container_width=True)

    with tab5:
        st.header("–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ")
        st.info("–§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –¥–ª—è –æ–∫—Ä–µ–º–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤.")
        c_ind1, c_ind2 = st.columns(2)
        with c_ind1:
            with st.form("new_ind_statement"):
                st.subheader("üìÑ –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥–æ–º—ñ—Å—Ç—å")
                st_list_i = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
                s_ind = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", st_list_i)
                subj_ind = st.selectbox("–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞", SUBJECTS_LIST)
                type_ind = st.selectbox("–¢–∏–ø –≤—ñ–¥–æ–º–æ—Å—Ç—ñ", [
                    "–ù–∞ –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è –æ—Ü—ñ–Ω–∫–∏",
                    "–ê–∫–∞–¥–µ–º—ñ—á–Ω–∞ —Ä—ñ–∑–Ω–∏—Ü—è",
                    "–Ü–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫",
                    "–ê—Ç–µ—Å—Ç–∞—Ü—ñ–π–Ω–∏–π –ª–∏—Å—Ç –µ–∫—Å—Ç–µ—Ä–Ω–∞",
                    "–ü–æ–∑–∞–ø–ª–∞–Ω–æ–≤–∞ –¥–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞"
                ])
                reason = st.text_input("–ü—ñ–¥—Å—Ç–∞–≤–∞ (‚Ññ —Ä–æ–∑–ø–æ—Ä—è–¥–∂–µ–Ω–Ω—è/–∑–∞—è–≤–∏)")
                if st.form_submit_button("–°—Ñ–æ—Ä–º—É–≤–∞—Ç–∏"):
                    c.execute("INSERT INTO individual_statements (student_name, subject, statement_type, reason, date_issued, status, created_by) VALUES (?,?,?,?,?,?,?)",
                              (s_ind, subj_ind, type_ind, reason, str(datetime.now().date()), "–ê–∫—Ç–∏–≤–Ω–∞", st.session_state['full_name']))
                    conn.commit()
                    st.success(f"–í—ñ–¥–æ–º—ñ—Å—Ç—å '{type_ind}' —Å—Ç–≤–æ—Ä–µ–Ω–æ!")
                    st.rerun()
        with c_ind2:
            st.subheader("üóÉÔ∏è –ê–∫—Ç–∏–≤–Ω—ñ —ñ–Ω–¥–∏–≤—ñ–¥—É–∞–ª—å–Ω—ñ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ")
            df_inds = pd.read_sql("SELECT * FROM individual_statements", conn)
            st.dataframe(df_inds, use_container_width=True)

    with tab6:
        st.header("–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏")
        st.info("–û–±–ª—ñ–∫ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –∑–æ–±–æ–≤'—è–∑–∞–Ω—å —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–Ω–æ—ó —Ñ–æ—Ä–º–∏ –Ω–∞–≤—á–∞–Ω–Ω—è.")
        col_con1, col_con2 = st.columns([1, 2])
        with col_con1:
            with st.form("contract_form"):
                st.subheader("üìù –î–∞–Ω—ñ –¥–æ–≥–æ–≤–æ—Ä—É")
                st_list_c = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
                s_contract = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", st_list_c)
                c_num = st.text_input("–ù–æ–º–µ—Ä –¥–æ–≥–æ–≤–æ—Ä—É")
                cd1, cd2 = st.columns(2)
                d_sign = cd1.date_input("–î–∞—Ç–∞ –ø—ñ–¥–ø–∏—Å–∞–Ω–Ω—è")
                d_end = cd2.date_input("–¢–µ—Ä–º—ñ–Ω –¥—ñ—ó –¥–æ")
                cm1, cm2 = st.columns(2)
                amount_total = cm1.number_input("–ó–∞–≥–∞–ª—å–Ω–∞ –≤–∞—Ä—Ç—ñ—Å—Ç—å (–≥—Ä–Ω)", min_value=0.0, step=100.0)
                amount_paid = cm2.number_input("–°–ø–ª–∞—á–µ–Ω–æ (–≥—Ä–Ω)", min_value=0.0, step=100.0)
                notes_c = st.text_area("–£–º–æ–≤–∏ –æ–ø–ª–∞—Ç–∏ / –ü—Ä–∏–º—ñ—Ç–∫–∏")
                calc_debt = amount_total - amount_paid
                status_c = "–°–ø–ª–∞—á–µ–Ω–æ –ø–æ–≤–Ω—ñ—Å—Ç—é" if calc_debt <= 0 else f"–ë–æ—Ä–≥: {calc_debt} –≥—Ä–Ω"
                if amount_paid == 0: status_c = "–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ"
                if st.form_submit_button("–ó–±–µ—Ä–µ–≥—Ç–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç"):
                    exists_c = c.execute("SELECT id FROM student_contracts WHERE student_name=? AND contract_number=?", (s_contract, c_num)).fetchone()
                    if exists_c:
                        c.execute("""UPDATE student_contracts SET 
                                     date_signed=?, end_date=?, total_amount=?, paid_amount=?, payment_status=?, notes=? 
                                     WHERE id=?""", 
                                     (str(d_sign), str(d_end), amount_total, amount_paid, status_c, notes_c, exists_c[0]))
                        st.success("–î–∞–Ω—ñ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–æ!")
                    else:
                        c.execute("""INSERT INTO student_contracts 
                                     (student_name, contract_number, date_signed, end_date, total_amount, paid_amount, payment_status, notes) 
                                     VALUES (?,?,?,?,?,?,?,?)""",
                                     (s_contract, c_num, str(d_sign), str(d_end), amount_total, amount_paid, status_c, notes_c))
                        st.success("–ù–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–∞–∫—Ç –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω–æ!")
                    conn.commit()
                    st.rerun()
        with col_con2:
            st.subheader("üìÇ –†–µ—î—Å—Ç—Ä –¥–æ–≥–æ–≤–æ—Ä—ñ–≤")
            total_debt_query = "SELECT SUM(total_amount - paid_amount) FROM student_contracts WHERE total_amount > paid_amount"
            debt_sum = c.execute(total_debt_query).fetchone()[0]
            debt_sum = debt_sum if debt_sum else 0
            st.metric("–ó–∞–≥–∞–ª—å–Ω–∞ –∑–∞–±–æ—Ä–≥–æ–≤–∞–Ω—ñ—Å—Ç—å –ø–æ —Ñ–∞–∫—É–ª—å—Ç–µ—Ç—É", f"{debt_sum:,.2f} –≥—Ä–Ω")
            df_contracts = pd.read_sql("SELECT * FROM student_contracts", conn)
            if not df_contracts.empty:
                def highlight_debt_contract(val):
                    if isinstance(val, str) and "–ë–æ—Ä–≥" in val:
                        return 'color: #ff4b4b; font-weight: bold'
                    elif isinstance(val, str) and "–ù–µ –æ–ø–ª–∞—á–µ–Ω–æ" in val:
                        return 'color: #ff4b4b'
                    return 'color: #00cc66'
                st.dataframe(df_contracts.style.map(highlight_debt_contract, subset=['payment_status']), use_container_width=True)
                st.download_button("‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä (CSV)", convert_df_to_csv(df_contracts), "contracts_registry.csv", "text/csv")
            else:
                st.info("–ö–æ–Ω—Ç—Ä–∞–∫—Ç—ñ–≤ —â–µ –Ω–µ –¥–æ–¥–∞–Ω–æ.")

# --- –ù–û–í–ò–ô –ú–û–î–£–õ–¨: –°–ï–°–Ü–Ø –¢–ê –†–£–• –ö–û–ù–¢–ò–ù–ì–ï–ù–¢–£ ---
def session_module_view():
    st.title("–°–µ—Å—ñ—è —Ç–∞ –†—É—Ö –∫–æ–Ω—Ç–∏–Ω–≥–µ–Ω—Ç—É")
    if st.session_state['role'] not in DEAN_LEVEL:
        st.error("–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ.")
        return

    conn = create_connection()
    c = conn.cursor()

    tab_session, tab_grading, tab_movement = st.tabs(["üìë –í—ñ–¥–æ–º–æ—Å—Ç—ñ (–°–µ—Å—ñ—è)", "‚úçÔ∏è –í–Ω–µ—Å–µ–Ω–Ω—è –æ—Ü—ñ–Ω–æ–∫", "üöÄ –†—É—Ö —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤"])

    # --- –í–ö–õ–ê–î–ö–ê 1: –°–¢–í–û–†–ï–ù–ù–Ø –í–Ü–î–û–ú–û–°–¢–ï–ô ---
    with tab_session:
        st.header("–ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ –µ–∫–∑–∞–º–µ–Ω–∞—Ü—ñ–π–Ω–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π")
        c1, c2 = st.columns([1, 2])
        
        with c1:
            with st.form("create_sheet"):
                st.subheader("‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥–æ–º—ñ—Å—Ç—å")
                sheet_num = st.text_input("–ù–æ–º–µ—Ä –≤—ñ–¥–æ–º–æ—Å—Ç—ñ (‚Ññ)")
                group_sel = st.selectbox("–ì—Ä—É–ø–∞", list(GROUPS_DATA.keys()))
                subj_sel = st.selectbox("–î–∏—Å—Ü–∏–ø–ª—ñ–Ω–∞", SUBJECTS_LIST)
                control_type = st.selectbox("–¢–∏–ø –∫–æ–Ω—Ç—Ä–æ–ª—é", ["–ï–∫–∑–∞–º–µ–Ω", "–ó–∞–ª—ñ–∫", "–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π –∑–∞–ª—ñ–∫", "–ü–µ—Ä–µ–∑–¥–∞—á–∞", "–ö–æ–º—ñ—Å—ñ—è"])
                date_exam = st.date_input("–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è")
                examiner = st.text_input("–ï–∫–∑–∞–º–µ–Ω–∞—Ç–æ—Ä", value=st.session_state['full_name'])
                
                if st.form_submit_button("–ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤—ñ–¥–æ–º—ñ—Å—Ç—å"):
                    if sheet_num:
                        c.execute("""INSERT INTO exam_sheets (sheet_number, group_name, subject, control_type, exam_date, examiner, status)
                                     VALUES (?,?,?,?,?,?,?)""", 
                                     (sheet_num, group_sel, subj_sel, control_type, str(date_exam), examiner, "–í—ñ–¥–∫—Ä–∏—Ç–∞"))
                        conn.commit()
                        st.success(f"–í—ñ–¥–æ–º—ñ—Å—Ç—å ‚Ññ{sheet_num} —Å—Ç–≤–æ—Ä–µ–Ω–∞!")
                        st.rerun()
                    else:
                        st.warning("–í–∫–∞–∂—ñ—Ç—å –Ω–æ–º–µ—Ä –≤—ñ–¥–æ–º–æ—Å—Ç—ñ.")

        with c2:
            st.subheader("üìÇ –ñ—É—Ä–Ω–∞–ª –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π")
            sheets_df = pd.read_sql("SELECT * FROM exam_sheets ORDER BY id DESC", conn)
            st.dataframe(sheets_df, use_container_width=True)
            if not sheets_df.empty:
                st.download_button("‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ä–µ—î—Å—Ç—Ä –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π", convert_df_to_csv(sheets_df), "exam_sheets.csv", "text/csv")

    # --- –í–ö–õ–ê–î–ö–ê 2: –í–ù–ï–°–ï–ù–ù–Ø –û–¶–Ü–ù–û–ö ---
    with tab_grading:
        st.header("–ó–∞–Ω–µ—Å–µ–Ω–Ω—è –æ—Ü—ñ–Ω–æ–∫ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö")
        st.info("–û—Ü—ñ–Ω–∫–∏, –≤–Ω–µ—Å–µ–Ω—ñ —Ç—É—Ç, –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ—Ç—Ä–∞–ø–ª—è—é—Ç—å —É –∑–∞–≥–∞–ª—å–Ω–∏–π –∂—É—Ä–Ω–∞–ª —É—Å–ø—ñ—à–Ω–æ—Å—Ç—ñ —Ç–∞ –≤—ñ–¥–æ–º—ñ—Å—Ç—å.")
        
        sheets = pd.read_sql("SELECT id, sheet_number, group_name, subject, control_type FROM exam_sheets WHERE status='–í—ñ–¥–∫—Ä–∏—Ç–∞'", conn)
        
        if not sheets.empty:
            sheet_options = sheets.apply(lambda x: f"‚Ññ{x['sheet_number']} | {x['group_name']} | {x['subject']} ({x['control_type']})", axis=1)
            selected_sheet_str = st.selectbox("–û–±–µ—Ä—ñ—Ç—å –∞–∫—Ç–∏–≤–Ω—É –≤—ñ–¥–æ–º—ñ—Å—Ç—å:", sheet_options)
            
            # –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö –æ–±—Ä–∞–Ω–æ—ó –≤—ñ–¥–æ–º–æ—Å—Ç—ñ
            sheet_idx = sheet_options[sheet_options == selected_sheet_str].index[0]
            sel_sheet_data = sheets.iloc[sheet_idx]
            
            curr_group = sel_sheet_data['group_name']
            curr_subj = sel_sheet_data['subject']
            curr_type = sel_sheet_data['control_type']
            
            st.markdown(f"**–ì—Ä—É–ø–∞:** {curr_group} | **–ü—Ä–µ–¥–º–µ—Ç:** {curr_subj} | **–¢–∏–ø:** {curr_type}")
            
            # –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–ø–∏—Å–∫—É —Å—Ç—É–¥–µ–Ω—Ç—ñ–≤ —Ç–∞ —ñ—Å–Ω—É—é—á–∏—Ö –æ—Ü—ñ–Ω–æ–∫
            students_list = pd.read_sql(f"SELECT full_name FROM students WHERE group_name='{curr_group}'", conn)['full_name'].tolist()
            existing_grades = pd.read_sql(f"""SELECT student_name, grade FROM grades 
                                              WHERE group_name='{curr_group}' AND subject='{curr_subj}' AND type_of_work='{curr_type}'""", conn)
            
            data = []
            for student in students_list:
                found = existing_grades[existing_grades['student_name'] == student]
                grade = found.iloc[0]['grade'] if not found.empty else 0
                data.append({"–°—Ç—É–¥–µ–Ω—Ç": student, "–û—Ü—ñ–Ω–∫–∞": grade})
            
            df_grading = pd.DataFrame(data)
            st.write("–ü—Ä–æ—Å—Ç–∞–≤—Ç–µ –æ—Ü—ñ–Ω–∫–∏ —É —Ç–∞–±–ª–∏—Ü—ñ –Ω–∏–∂—á–µ:")

            # --- –ü–ï–†–ï–í–Ü–†–ö–ê –†–û–õ–Ü –¢–ï–•–ù–Ü–ß–ù–û–ì–û –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê ---
            if st.session_state['role'] == 'tech_admin':
                st.warning("‚ö†Ô∏è –£ –≤–∞—Å —î –ø—Ä–∞–≤–∞ –Ω–∞ –ø–µ—Ä–µ–≥–ª—è–¥ –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π, –∞–ª–µ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ.")
                st.dataframe(df_grading, use_container_width=True)
            else:
                edited_grades = st.data_editor(df_grading, use_container_width=True, key="editor_exam")
                
                if st.button("üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ –æ—Ü—ñ–Ω–∫–∏ –≤ –ë–î", key="save_exam_grades"):
                    date_now = str(datetime.now().date())
                    count_updated = 0
                    
                    for index, row in edited_grades.iterrows():
                        s_name = row['–°—Ç—É–¥–µ–Ω—Ç']
                        s_grade = row['–û—Ü—ñ–Ω–∫–∞']
                        
                        check = c.execute("""SELECT id FROM grades WHERE student_name=? AND subject=? AND type_of_work=?""", 
                                         (s_name, curr_subj, curr_type)).fetchone()
                        
                        if check:
                            c.execute("UPDATE grades SET grade=?, date=? WHERE id=?", (s_grade, date_now, check[0]))
                        else:
                            c.execute("""INSERT INTO grades (student_name, group_name, subject, type_of_work, grade, date)
                                         VALUES (?,?,?,?,?,?)""", (s_name, curr_group, curr_subj, curr_type, s_grade, date_now))
                        count_updated += 1
                    
                    conn.commit()
                    st.success(f"–£—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ {count_updated} –æ—Ü—ñ–Ω–æ–∫!")
                    log_action(st.session_state['full_name'], "Exam Grading", f"–í–Ω–µ—Å–µ–Ω–æ –æ—Ü—ñ–Ω–∫–∏: {curr_group}, {curr_subj}")
                    st.rerun()
        else:
            st.warning("–ù–µ–º–∞—î –≤—ñ–¥–∫—Ä–∏—Ç–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π. –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤—É —É –≤–∫–ª–∞–¥—Ü—ñ '–í—ñ–¥–æ–º–æ—Å—Ç—ñ'.")

    # --- –í–ö–õ–ê–î–ö–ê 3: –†–£–• –ö–û–ù–¢–ò–ù–ì–ï–ù–¢–£ ---
    with tab_movement:
        st.header("–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –Ω–∞–≤—á–∞–ª—å–Ω–∏–π —Ä—ñ–∫")
        col_move1, col_move2 = st.columns(2)
        
        with col_move1:
            st.subheader("üîÑ –ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –≥—Ä—É–ø–∏ (–∫—É—Ä—Å +1)")
            move_group = st.selectbox("–û–±–µ—Ä—ñ—Ç—å –≥—Ä—É–ø—É", list(GROUPS_DATA.keys()), key="move_grp")
            
            match = re.match(r"(\d+)(.*)", move_group)
            next_name = move_group
            is_graduating = False
            
            if match:
                num, rest = int(match.group(1)), match.group(2)
                if num < 4: next_name = f"{num+1}{rest}"
                else:
                    next_name = f"–í–∏–ø—É—Å–∫-{move_group}"
                    is_graduating = True
            
            new_group_name = st.text_input("–ù–æ–≤–∞ –Ω–∞–∑–≤–∞ –≥—Ä—É–ø–∏:", value=next_name)
            
            if st.button("–í–∏–∫–æ–Ω–∞—Ç–∏ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è"):
                if is_graduating:
                    students = pd.read_sql(f"SELECT full_name FROM students WHERE group_name='{move_group}'", conn)['full_name'].tolist()
                    for s in students:
                        c.execute("UPDATE student_education_info SET status='–í–∏–ø—É—Å–∫–Ω–∏–∫' WHERE student_name=?", (s,))
                        c.execute("UPDATE students SET group_name=? WHERE full_name=?", (new_group_name, s))
                else:
                    c.execute("UPDATE students SET group_name=? WHERE group_name=?", (new_group_name, move_group))
                    c.execute("UPDATE student_education_info SET course = course + 1 WHERE student_name IN (SELECT full_name FROM students WHERE group_name=?)", (new_group_name,))
                
                conn.commit()
                log_action(st.session_state['full_name'], "Group Move", f"{move_group} -> {new_group_name}")
                st.success("–ü–µ—Ä–µ–≤–µ–¥–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–æ!")
                st.rerun()

        with col_move2:
            st.subheader("üö´ –í—ñ–¥—Ä–∞—Ö—É–≤–∞–Ω–Ω—è / –ê–∫–∞–¥–µ–º–≤—ñ–¥–ø—É—Å—Ç–∫–∞")
            action_type = st.selectbox("–î—ñ—è", ["–í—ñ–¥—Ä–∞—Ö—É–≤–∞–Ω–Ω—è", "–ê–∫–∞–¥–µ–º–≤—ñ–¥–ø—É—Å—Ç–∫–∞"])
            all_students = pd.read_sql("SELECT full_name FROM students", conn)['full_name'].tolist()
            student_to_action = st.selectbox("–°—Ç—É–¥–µ–Ω—Ç", all_students, key="st_action")
            reason_move = st.text_input("–ü—Ä–∏—á–∏–Ω–∞ / ‚Ññ –ù–∞–∫–∞–∑—É")
            
            if st.button("–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏"):
                status_map = {"–í—ñ–¥—Ä–∞—Ö—É–≤–∞–Ω–Ω—è": "–í—ñ–¥—Ä–∞—Ö–æ–≤–∞–Ω–∏–π", "–ê–∫–∞–¥–µ–º–≤—ñ–¥–ø—É—Å—Ç–∫–∞": "–£ –∞–∫–∞–¥–µ–º–≤—ñ–¥–ø—É—Å—Ç—Ü—ñ"}
                new_status = status_map[action_type]
                c.execute("INSERT OR IGNORE INTO student_education_info (student_name) VALUES (?)", (student_to_action,))
                c.execute("UPDATE student_education_info SET status=? WHERE student_name=?", (new_status, student_to_action))
                
                if action_type == "–í—ñ–¥—Ä–∞—Ö—É–≤–∞–Ω–Ω—è":
                    c.execute("DELETE FROM students WHERE full_name=?", (student_to_action,))
                
                conn.commit()
                log_action(st.session_state['full_name'], "Status Change", f"{student_to_action}: {new_status}")
                st.success("–°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–µ–Ω–æ!")
                st.rerun()

def system_settings_view():
    st.title("–°–∏—Å—Ç–µ–º–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è")
    
    if st.session_state['role'] != 'admin':
        st.error("–î–æ—Å—Ç—É–ø –∑–∞–±–æ—Ä–æ–Ω–µ–Ω–æ! –¢—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤.")
        return

    conn = create_connection()
    c = conn.cursor()
    
    t_roles, t_logs = st.tabs(["üë• –ö–µ—Ä—É–≤–∞–Ω–Ω—è –†–æ–ª—è–º–∏", "üìú –õ–æ–≥–∏ –î—ñ–π"])
    
    with t_roles:
        st.header("–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É")
        users_df = pd.read_sql("SELECT username, full_name, role, group_link FROM users", conn)
        st.dataframe(users_df, use_container_width=True)
        
        st.divider()
        with st.form("change_role_form"):
            col_u, col_r = st.columns(2)
            u_select = col_u.selectbox("–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞", users_df['username'].tolist())
            r_select = col_r.selectbox("–ù–æ–≤–∞ —Ä–æ–ª—å", ROLES_LIST)
            
            if st.form_submit_button("–ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–ª—å"):
                c.execute("UPDATE users SET role=? WHERE username=?", (r_select, u_select))
                conn.commit()
                log_action(st.session_state['full_name'], "Role Change", f"–ó–º—ñ–Ω–µ–Ω–æ —Ä–æ–ª—å {u_select} –Ω–∞ {r_select}")
                st.success(f"–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—É {u_select} –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ —Ä–æ–ª—å {r_select}")
                st.rerun()

    with t_logs:
        st.header("–ñ—É—Ä–Ω–∞–ª –ø–æ–¥—ñ–π (Audit Log)")
        logs_df = pd.read_sql("SELECT * FROM system_logs ORDER BY id DESC", conn)
        
        col_fil1, col_fil2 = st.columns(2)
        filter_user = col_fil1.selectbox("–§—ñ–ª—å—Ç—Ä –ø–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—É", ["–í—Å—ñ"] + logs_df['user'].unique().tolist())
        filter_action = col_fil2.selectbox("–§—ñ–ª—å—Ç—Ä –ø–æ –¥—ñ—ó", ["–í—Å—ñ"] + logs_df['action'].unique().tolist())
        
        if filter_user != "–í—Å—ñ":
            logs_df = logs_df[logs_df['user'] == filter_user]
        if filter_action != "–í—Å—ñ":
            logs_df = logs_df[logs_df['action'] == filter_action]
            
        st.dataframe(logs_df, use_container_width=True)
        st.download_button("‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ª–æ–≥ (CSV)", convert_df_to_csv(logs_df), "system_logs.csv", "text/csv")


def main():
    init_db()
    if 'logged_in' not in st.session_state:
        st.session_state['logged_in'] = False
        st.session_state['role'] = None
        st.session_state['full_name'] = ""

    if not st.session_state['logged_in']:
        login_register_page()
    else:
        # --- –í–Ü–î–û–ë–†–ê–ñ–ï–ù–ù–Ø –ü–†–û–§–Ü–õ–Æ –¢–ê –†–û–õ–Ü –í SIDEBAR ---
        st.sidebar.title(f"üë§ {st.session_state['full_name']}")
        
        role_upper = st.session_state['role'].upper()
        
        # –õ–æ–≥—ñ–∫–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç—É—Å—ñ–≤ —Ä–æ–ª–µ–π
        if st.session_state['role'] == 'student':
             st.sidebar.markdown("### üõ°Ô∏è –°–¢–£–î–ï–ù–¢ (READ ONLY)")
        elif st.session_state['role'] == 'tech_admin':
             st.sidebar.markdown("### ‚öôÔ∏è –¢–ï–•–ù–Ü–ß–ù–ò–ô –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†")
        elif st.session_state['role'] == 'teacher':
             st.sidebar.markdown("### üë®‚Äçüè´ –í–ò–ö–õ–ê–î–ê–ß (ACADEMIC)")
        else:
             # –î–ª—è dean, admin, methodist –ø–æ–∫–∞–∑—É—î–º–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏–π –ø—ñ–¥–ø–∏—Å
             st.sidebar.caption(f"–†–æ–ª—å: {role_upper}")
        
        # –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω–∏ —Ç–µ–º–∏
        if st.sidebar.button("–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ —Ç–µ–º—É üåì"):
            toggle_theme()
            st.rerun()
            
        st.sidebar.divider()
        
        # --- –ù–ê–õ–ê–®–¢–£–í–ê–ù–ù–Ø –ú–ï–ù–Æ –ù–ê–í–Ü–ì–ê–¶–Ü–á ---
        menu_options = {
            "–ì–æ–ª–æ–≤–Ω–∞ –ø–∞–Ω–µ–ª—å": main_panel,
            "–°—Ç—É–¥–µ–Ω—Ç–∏ —Ç–∞ –ì—Ä—É–ø–∏": students_groups_view,
            "–í–∏–∫–ª–∞–¥–∞—á—ñ —Ç–∞ –ö–∞—Ñ–µ–¥—Ä–∏": teachers_view,
            "–†–æ–∑–∫–ª–∞–¥ –∑–∞–Ω—è—Ç—å": schedule_view,
            "–ï–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∏–π –∂—É—Ä–Ω–∞–ª": gradebook_view,
            "–ñ—É—Ä–Ω–∞–ª –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–æ—Å—Ç—ñ": attendance_view,
            "–ó–≤—ñ—Ç–∏ —Ç–∞ –ü–æ—à—É–∫": reports_view,
            "–î–æ–∫—É–º–µ–Ω—Ç–æ–æ–±—ñ–≥": documents_view,
            "–§–∞–π–ª–æ–≤–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π": file_repository_view
        }
        
        # –î–æ—Å—Ç—É–ø –¥–æ —Å–ø–µ—Ü–º–æ–¥—É–ª—ñ–≤ (tech_admin –≤—Ö–æ–¥–∏—Ç—å –¥–æ DEAN_LEVEL)
        if st.session_state['role'] in DEAN_LEVEL:
            menu_options["–ú–æ–¥—É–ª—ñ –î–µ–∫–∞–Ω–∞—Ç—É"] = deanery_modules_view
            menu_options["–°–µ—Å—ñ—è —Ç–∞ –†—É—Ö"] = session_module_view 
        
        # –î–æ—Å—Ç—É–ø –¥–æ —Å–∏—Å—Ç–µ–º–Ω–∏—Ö –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è admin)
        if st.session_state['role'] == 'admin':
            menu_options["–°–∏—Å—Ç–µ–º–Ω—ñ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è"] = system_settings_view

        # –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–∏–±—Ä–∞–Ω–æ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        selection = st.sidebar.radio("–ù–∞–≤—ñ–≥–∞—Ü—ñ—è", list(menu_options.keys()))
        menu_options[selection]()
        
        st.sidebar.divider()
        
        # –ö–Ω–æ–ø–∫–∞ –≤–∏—Ö–æ–¥—É
        if st.sidebar.button("–í–∏–π—Ç–∏ üö™"):
            st.session_state['logged_in'] = False
            st.rerun()

if __name__ == '__main__':
    main()
